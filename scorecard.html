<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ê³¨í”„ ìŠ¤ì½”ì–´ ì‹¬í”Œ ê°œì„ íŒ (V12 - í•©ê³„ ìµœì í™”)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter í°íŠ¸ë¥¼ ê¸°ë³¸ìœ¼ë¡œ ì„¤ì • */
        body { font-family: "Inter", sans-serif; }
        
        /* ëª¨ë°”ì¼ í„°ì¹˜ë¥¼ ìœ„í•œ ìµœì†Œ í¬ê¸° ë³´ì¥ */
        .counter-button { min-width: 4rem; min-height: 4rem; }
        .par-button, .score-cell { cursor: pointer; }
        
        /* ìŠ¤ì½”ì–´ì¹´ë“œ í…Œì´ë¸” ìŠ¤íƒ€ì¼ */
        .scorecard-table { width: 100%; border-collapse: collapse; }
        .scorecard-table th, .scorecard-table td {
            border-bottom: 1px solid #e5e7eb; /* Gray-200, í•˜ë‹¨ ì¤„ë§Œ ìœ ì§€ */
            padding: 10px 4px;
            text-align: center;
            font-size: 0.875rem; /* text-sm */
        }
        .scorecard-table th { background-color: #f9fafb; } /* Light Gray for Hole/Header */
        .scorecard-table thead th { border-bottom: 2px solid #10b981; } /* Accent line for header */

        /* ìŠ¤ì½”ì–´ë³„ ìƒ‰ìƒ ì •ì˜ (Diffì— ì ìš©) */
        .score-eagle { background-color: #065f46; color: white; } /* Dark Green for Eagle/Albatross */
        .score-birdie { background-color: #3b82f6; color: white; } /* Blue for Birdie */
        .score-par { background-color: #374151; color: white; } /* Dark Gray for Par */
        .score-bogey { background-color: #f97316; color: white; } /* Orange for Bogey */
        .score-dbogey { background-color: #ef4444; color: white; } /* Red for Double Bogey+ */
        .score-yangpa { background-color: #9333ea; color: white; } /* Purple for Double Par (ì–‘íŒŒ) */
        
        /* í•©ê³„ í–‰ ìŠ¤íƒ€ì¼ */
        .section-total-row th, .section-total-row td {
            background-color: #d1fae5; /* Green-100 */
            font-weight: bold;
            border-top: 3px solid #10b981; /* Accent Line */
        }
        
        /* ì „ë°˜/í›„ë°˜ êµ¬ë¶„ì„  */
        .section-divider {
            background-color: #e5e7eb; /* Gray-200 */
            font-size: 1rem;
            font-weight: bold;
            color: #4b5563;
        }

    </style>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'golf-green': '#10b981', /* Emerald Green */
                        'dark-green': '#059669',
                        'light-gray': '#f4f4f5', /* Zinc-100 for background */
                    },
                }
            }
        }
        
        // --- App State (ì „ì—­ ìƒíƒœ ë° Local Storage í‚¤) ---
        window.scorecard = []; // 18í™€ ìŠ¤ì½”ì–´ì¹´ë“œ ë°ì´í„° ë°°ì—´
        window.currentHoleIndex = -1; // í˜„ì¬ ëª¨ë‹¬ì—ì„œ í¸ì§‘ ì¤‘ì¸ í™€ (0-17)
        const LOCAL_STORAGE_KEY = 'golfScorecardData_v4_18H'; // 18í™€ ë²„ì „ í‚¤
        const MOCK_HANDICAP = 13; // í•©ê³„ ìµœì í™”ë¥¼ ìœ„í•´ ì„ì˜ë¡œ ì ìš©í•œ í•¸ë””ìº¡

        // 18í™€ ì´ˆê¸° ìŠ¤ì½”ì–´ì¹´ë“œ êµ¬ì¡° (Par 72 ê¸°ì¤€ì˜ ì¼ë°˜ì ì¸ Par ì„¤ì •)
        // Front 9 (1-9): 4, 4, 3, 4, 5, 4, 3, 4, 5 (Par 36)
        // Back 9 (10-18): 4, 4, 3, 4, 5, 4, 3, 4, 5 (Par 36)
        const initialParSequence = [4, 4, 3, 4, 5, 4, 3, 4, 5, 4, 4, 3, 4, 5, 4, 3, 4, 5];
        
        const initialHoleData = Array.from({ length: 18 }, (_, i) => ({
            hole: i + 1,
            par: initialParSequence[i], 
            score: 0,
            strokesNonPutt: 0,
            putts: 0,
            penalty1x: 0,
            penalty2x: 0,
        }));

        /**
         * Local Storageì—ì„œ ìŠ¤ì½”ì–´ì¹´ë“œ ë°ì´í„°ë¥¼ ë¡œë“œí•˜ê±°ë‚˜ ì´ˆê¸°ê°’ì„ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function loadScorecardFromLocalStorage() {
            try {
                const storedData = localStorage.getItem(LOCAL_STORAGE_KEY);
                if (storedData) {
                    const parsedData = JSON.parse(storedData);
                    if (Array.isArray(parsedData) && parsedData.length === 18) {
                        // ì €ì¥ëœ ë°ì´í„°ê°€ 18í™€ í˜•ì‹ì´ë©´ ë¡œë“œ
                        window.scorecard = parsedData.map((hole, i) => ({
                             ...initialHoleData[i], // ê¸°ë³¸ êµ¬ì¡°ì™€ Par ê°’ ë³´ì¡´
                             ...hole // ì €ì¥ëœ ê°’ (score, putts ë“±) ë®ì–´ì“°ê¸°
                        }));
                        return;
                    }
                }
            } catch (e) {
                console.error("Local Storage ë¡œë“œ ì˜¤ë¥˜ (18H):", e);
            }
            window.scorecard = initialHoleData;
            console.log("ìƒˆ 18í™€ ìŠ¤ì½”ì–´ì¹´ë“œë¡œ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.");
        }

        /**
         * í˜„ì¬ ìŠ¤ì½”ì–´ì¹´ë“œ ìƒíƒœë¥¼ Local Storageì— ì €ì¥í•©ë‹ˆë‹¤.
         */
        function saveScorecardToLocalStorage() {
            try {
                localStorage.setItem(LOCAL_STORAGE_KEY, JSON.stringify(window.scorecard));
                console.log("Scorecard saved to Local Storage (V4_18H).");
            } catch (e) {
                console.error("Local Storage ì €ì¥ ì˜¤ë¥˜:", e);
            }
        }
        
        // --- Core Application Logic (ê³„ì‚°/ëª¨ë‹¬/ë Œë”ë§) ---

        /**
         * ìµœì¢… íƒ€ìˆ˜ì™€ Par ì •ë³´ë¥¼ ë°”íƒ•ìœ¼ë¡œ ìŠ¤ì½”ì–´ ë©”ì‹œì§€ë¥¼ ìƒì„±í•˜ê³  CSS í´ë˜ìŠ¤ë¥¼ ë°˜í™˜í•©ë‹ˆë‹¤.
         */
        function getScoreResult(totalScore, scoreDiff, par) {
            const doublePar = 2 * par; 
            let result = { text: '-', colorClass: 'text-gray-500 bg-gray-100', diffText: '-' };
            
            if (totalScore === 0 || par === 0) return result;
            
            // 1. ì ìˆ˜ ì°¨ì´ í…ìŠ¤íŠ¸ ì„¤ì •
            result.diffText = scoreDiff > 0 ? `+${scoreDiff}` : (scoreDiff < 0 ? `${scoreDiff}` : 'E');
            result.text = `${totalScore}íƒ€`;

            // 2. Double Par ë£° ìš°ì„  ì ìš© (Double Par ì´ìƒ)
            if (totalScore >= doublePar) { 
                result.text = "ì–‘íŒŒ (Double Par)"; 
                result.colorClass = "score-yangpa";
                return result; 
            } 
            
            // 3. ì¼ë°˜ ìŠ¤ì½”ì–´ ê³„ì‚° (Score Diff ê¸°ë°˜)
            if (scoreDiff <= -3) {
                result.text = "Albatross"; 
                result.colorClass = "score-eagle";
            } else if (scoreDiff === -2) {
                result.text = "Eagle";
                result.colorClass = "score-eagle";
            } else if (scoreDiff === -1) {
                result.text = "Birdie";
                result.colorClass = "score-birdie";
            } else if (scoreDiff === 0) {
                result.text = "Par";
                result.colorClass = "score-par";
            } else if (scoreDiff === 1) {
                result.text = "Bogey"; 
                result.colorClass = "score-bogey";
            } else if (scoreDiff === 2) { 
                result.text = "Double Bogey"; 
                result.colorClass = "score-dbogey";
            } else if (scoreDiff === 3) { 
                result.text = "Triple Bogey"; 
                result.colorClass = "score-dbogey";
            } else if (scoreDiff === 4) { 
                result.text = "Quadruple Bogey"; 
                result.colorClass = "score-dbogey";
            } else if (scoreDiff === 5) { 
                result.text = "Quintuple Bogey"; // í€¸íˆ¬í”Œ ë³´ê¸° (+5)
                result.colorClass = "score-dbogey";
            } else if (scoreDiff >= 6) { 
                result.text = "Sextuple Bogey+"; // ì„¹ìŠ¤íŠœí”Œ ë³´ê¸° (+6 ì´ìƒ)
                result.colorClass = "score-dbogey";
            }
            
            return result;
        }
        
        /**
         * 18í™€ ìŠ¤ì½”ì–´ì¹´ë“œ ì „ì²´ë¥¼ ë Œë”ë§í•˜ê³  ì´í•©ê³„ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. (ë‹¨ì¼ í…Œì´ë¸”ë¡œ í†µí•©)
         */
        function renderScorecard18Holes() {
            const scorecardBody = document.getElementById('scorecard_body');
            scorecardBody.innerHTML = '';
            
            let totalPar = 0;
            let totalScore = 0;
            let frontNinePar = 0;
            let frontNineScore = 0;
            let backNinePar = 0;
            let backNineScore = 0;
            
            // ì „ë°˜ 9í™€ í—¤ë” ì¶”ê°€
            scorecardBody.innerHTML += `
                <tr>
                    <td colspan="4" class="section-divider py-3 bg-gray-100 border-t-4 border-gray-300">
                        â›³ ì „ë°˜ 9í™€ (OUT)
                    </td>
                </tr>
            `;

            window.scorecard.forEach((hole, index) => {
                totalPar += hole.par;
                totalScore += hole.score;
                
                const scoreDiff = hole.score - hole.par;
                const scoreResult = getScoreResult(hole.score, scoreDiff, hole.par);
                
                const isFrontNine = index < 9;
                if (isFrontNine) {
                    frontNinePar += hole.par;
                    frontNineScore += hole.score;
                } else {
                    backNinePar += hole.par;
                    backNineScore += hole.score;
                }
                
                // ì „ë°˜/í›„ë°˜ êµ¬ë¶„ì„  ì‚½ì… (10ë²ˆ í™€ ì‹œì‘ ì „)
                if (index === 9) {
                    // ì „ë°˜ í•©ê³„ í–‰ ì‚½ì…
                    scorecardBody.innerHTML += createSectionTotalRow('ì „ë°˜', frontNinePar, frontNineScore, true);
                    
                    // í›„ë°˜ ì‹œì‘ êµ¬ë¶„ì„ 
                    scorecardBody.innerHTML += `
                        <tr>
                            <td colspan="4" class="section-divider py-3 bg-gray-100 border-t-4 border-gray-300">
                                â›³ í›„ë°˜ 9í™€ (IN)
                            </td>
                        </tr>
                    `;
                }

                const row = `
                    <tr class="hover:bg-gray-50 transition-colors cursor-pointer" onclick="openScoreModal(${index})">
                        <!-- Hole -->
                        <th class="font-bold text-gray-800">${hole.hole}</th>
                        <!-- Par -->
                        <td class="text-lg font-medium text-gray-700">${hole.par}</td>
                        <!-- Score -->
                        <td class="font-extrabold text-xl text-gray-900">
                            ${hole.score > 0 ? hole.score : '<span class="text-gray-400">-</span>'}
                        </td>
                        <!-- Diff (Badge) -->
                        <td>
                            <div class="inline-block text-xs font-bold rounded-full py-1 px-2 ${hole.score > 0 ? scoreResult.colorClass : 'text-gray-500 bg-gray-100'} transition duration-150 shadow-sm">
                                ${hole.score > 0 ? scoreResult.diffText : '-'}
                            </div>
                        </td>
                    </tr>
                `;
                scorecardBody.innerHTML += row;
            });
            
            // í›„ë°˜ í•©ê³„ í–‰ ì‚½ì… (18í™€ ì™„ë£Œ í›„)
            scorecardBody.innerHTML += createSectionTotalRow('í›„ë°˜', backNinePar, backNineScore, false);

            // ìµœì¢… ì´í•©ê³„ ê³„ì‚° ë° ë Œë”ë§ (ìˆœ íƒ€ìˆ˜ ê°•ì¡° ìµœì í™”)
            const totalScoreDiff = totalScore - totalPar;
            
            // ìˆœ íƒ€ìˆ˜ ê³„ì‚° (ì´ íƒ€ìˆ˜ - í•¸ë””ìº¡)
            const netScore = totalScore > 0 ? totalScore - MOCK_HANDICAP : 0;
            const netDiff = netScore - totalPar; // ìˆœ íƒ€ìˆ˜ ëŒ€ë¹„ Par ì°¨ì´
            
            let diffTextTotal = ''; // ì´ íƒ€ìˆ˜ ëŒ€ë¹„ Par ì°¨ì´
            if (totalScore === 0) diffTextTotal = '-'; 
            else if (totalScoreDiff > 0) diffTextTotal = `+${totalScoreDiff}`;
            else if (totalScoreDiff < 0) diffTextTotal = `${totalScoreDiff}`;
            else diffTextTotal = 'E'; // Even Par

            let netDiffText = ''; // ìˆœ íƒ€ìˆ˜ ëŒ€ë¹„ Par ì°¨ì´
            if (netScore === 0) netDiffText = '-'; 
            else if (netDiff > 0) netDiffText = `+${netDiff}`;
            else if (netDiff < 0) netDiffText = `${netDiff}`;
            else netDiffText = 'E'; // Even Par


            const totalsDiv = document.getElementById('scorecard_totals');
            totalsDiv.innerHTML = `
                <div class="p-4 bg-dark-green text-white rounded-b-xl">
                    <!-- 1. Gross Score ë° Par ì •ë³´ -->
                    <div class="flex justify-between items-center pb-2 border-b border-white/20">
                         <span class="text-lg font-extrabold opacity-90">ì´ íƒ€ìˆ˜ (GROSS) / Par</span>
                         <div class="flex space-x-4 items-baseline">
                            <span class="text-xl font-light opacity-80">Par ${totalPar}</span>
                            <span class="text-3xl font-extrabold">${totalScore > 0 ? totalScore : '-'}</span>
                            <div class="text-xl font-extrabold px-3 py-1 bg-white/20 rounded-lg">
                               ${diffTextTotal}
                            </div>
                         </div>
                    </div>
                    
                    <!-- 2. NET SCORE ê°•ì¡° (ìµœì í™”ëœ í•µì‹¬ ì •ë³´) -->
                    <div class="pt-3 flex justify-between items-center bg-dark-green text-white">
                        <div class="flex flex-col">
                            <span class="text-xs font-medium text-white/70">ì ìš© í•¸ë””ìº¡ (HCP): ${MOCK_HANDICAP}</span>
                            <span class="text-2xl font-black mt-1 text-yellow-300">ìˆœ íƒ€ìˆ˜ (NET SCORE)</span>
                        </div>
                        <div class="text-right">
                             <span class="text-4xl font-black text-yellow-300">${netScore > 0 ? netScore : '-'}</span>
                             <div class="text-base font-extrabold px-3 py-1 bg-white/20 rounded-lg mt-1 inline-block">
                                Net Diff: ${netDiffText}
                             </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        /**
         * ì„¹ì…˜ í•©ê³„ (ì „ë°˜/í›„ë°˜) í–‰ì„ ìƒì„±í•©ë‹ˆë‹¤.
         */
        function createSectionTotalRow(sectionTitle, sectionTotalPar, sectionTotalScore, isFront) {
            const sectionScoreDiff = sectionTotalScore - sectionTotalPar;
            let sectionDiffText = sectionTotalScore === 0 ? '-' : (sectionScoreDiff > 0 ? `+${sectionScoreDiff}` : (sectionScoreDiff < 0 ? `${sectionScoreDiff}` : 'E'));

            return `
                <tr class="section-total-row">
                    <th class="font-bold text-base bg-green-200">${sectionTitle} SUM</th>
                    <td class="text-base font-bold bg-green-100">${sectionTotalPar}</td>
                    <td class="text-xl font-extrabold bg-green-100">${sectionTotalScore > 0 ? sectionTotalScore : '-'}</td>
                    <td class="bg-green-100">
                         <div class="inline-block text-sm font-extrabold px-3 py-1 bg-dark-green text-white rounded-lg">
                           ${sectionDiffText}
                        </div>
                    </td>
                </tr>
            `;
        }


        /**
         * Par ê°’ì„ ì„ íƒí•˜ê³  UIë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤. (ëª¨ë‹¬ ë‚´ë¶€)
         */
        window.selectPar = function(selectedPar, clickedButton) {
            const selectorDiv = document.getElementById('modal_par_selector');
            const parButtons = selectorDiv.querySelectorAll('.par-button');
            
            // ëª¨ë“  ë²„íŠ¼ ì´ˆê¸°í™”
            parButtons.forEach(btn => {
                btn.classList.remove('bg-golf-green', 'text-white', 'border-dark-green', 'shadow-md');
                btn.classList.add('bg-gray-100', 'text-gray-900', 'border-gray-300', 'hover:bg-gray-200');
            });

            // ì„ íƒëœ ë²„íŠ¼ í•˜ì´ë¼ì´íŠ¸
            if (clickedButton) {
                clickedButton.classList.remove('bg-gray-100', 'text-gray-900', 'border-gray-300', 'hover:bg-gray-200');
                clickedButton.classList.add('bg-golf-green', 'text-white', 'border-dark-green', 'shadow-lg');
            } 
            
            // ì„ íƒëœ Par ê°’ ì—…ë°ì´íŠ¸
            selectorDiv.setAttribute('data-selected-par', selectedPar);
            document.getElementById('modal_current_par_display').innerText = selectedPar;

            calculateScore();
        }


        /**
         * ì¹´ìš´í„° ê°’ì„ ë³€ê²½í•˜ê³  ê³„ì‚°ì„ ì¬ì‹¤í–‰í•©ë‹ˆë‹¤. (ëª¨ë‹¬ ë‚´ë¶€)
         */
        window.changeCount = function(id, delta) {
            const countElement = document.getElementById(id + '_count');
            let currentValue = parseInt(countElement.innerText) || 0;
            let newValue = currentValue + delta;

            if (newValue < 0) newValue = 0;

            countElement.innerText = newValue;
            calculateScore();
        }

        /**
         * ìµœì¢… ìŠ¤ì½”ì–´ë¥¼ ê³„ì‚°í•˜ê³  ê²°ê³¼ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤. (ëª¨ë‹¬ ë‚´ë¶€)
         */
        function calculateScore() {
            try {
                const par = parseInt(document.getElementById('modal_par_selector').getAttribute('data-selected-par')) || 0;
                const strokesNonPutt = parseInt(document.getElementById('strokes_non_putt_count').innerText) || 0;
                const putts = parseInt(document.getElementById('putts_count').innerText) || 0;
                const penalty1x = parseInt(document.getElementById('penalty_1x_count').innerText) || 0;
                const penalty2x = parseInt(document.getElementById('penalty_2x_count').innerText) || 0;

                // íƒ€ìˆ˜: ì½”ìŠ¤ ìƒ· + í¼íŒ…
                const actualStrokes = strokesNonPutt + putts;
                // ë²Œíƒ€: 1ë²Œíƒ€ íšŸìˆ˜ * 1 + 2ë²Œíƒ€ íšŸìˆ˜ * 2
                const totalPenalties = (penalty1x * 1) + (penalty2x * 2);
                // ìµœì¢… ìŠ¤ì½”ì–´ = íƒ€ìˆ˜ + ë²Œíƒ€
                const totalScore = actualStrokes + totalPenalties;

                const scoreDifference = totalScore - par;

                // ê²°ê³¼ í‘œì‹œ (totalScore, scoreDifference, par ëª¨ë‘ ì „ë‹¬)
                displayModalResult(totalScore, scoreDifference, par);
            } catch (error) {
                console.error("ê³„ì‚° ì˜¤ë¥˜:", error);
                document.getElementById('modal_result_message').innerHTML = `
                    <div class="p-3 bg-red-100 text-red-700 rounded-lg">
                        âš ï¸ ê°’ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.
                    </div>
                `;
            }
        }

        /**
         * ê³„ì‚°ëœ ê²°ê³¼ë¥¼ ëª¨ë‹¬ UIì— í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function displayModalResult(totalScore, scoreDifference, par) {
            const resultDiv = document.getElementById('modal_result_message');
            const scoreMsg = getScoreResult(totalScore, scoreDifference, par);
            
            // ëª¨ë‹¬ì˜ 'ì ìš©' ë²„íŠ¼ì— ê³„ì‚°ëœ ìµœì¢… ìŠ¤ì½”ì–´ ì €ì¥
            const applyButton = document.getElementById('apply_score_button');
            applyButton.setAttribute('data-score', totalScore);
            applyButton.setAttribute('data-par', par);
            applyButton.setAttribute('data-strokes', document.getElementById('strokes_non_putt_count').innerText);
            applyButton.setAttribute('data-putts', document.getElementById('putts_count').innerText);
            applyButton.setAttribute('data-p1x', document.getElementById('penalty_1x_count').innerText);
            applyButton.setAttribute('data-p2x', document.getElementById('penalty_2x_count').innerText);
            
            // 0íƒ€ì¼ ê²½ìš° ì ìš© ë²„íŠ¼ ë¹„í™œì„±í™” (ë²„ê·¸ ë°©ì§€)
            const isValidScore = totalScore > 0;
            applyButton.disabled = !isValidScore;
            applyButton.classList.toggle('opacity-50', !isValidScore);
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
            applyButton.innerText = `ìŠ¤ì½”ì–´ ì ìš© (${totalScore}íƒ€)`;
            
            resultDiv.innerHTML = `
                <div class="text-center p-4 bg-white border-t-4 border-dark-green rounded-b-xl shadow-inner mt-4">
                    <p class="text-base text-gray-600 mb-2 font-medium">Par ${par} í™€ ìµœì¢… ê²°ê³¼</p>
                    <div class="flex flex-col items-center justify-center space-y-3">
                        <!-- ìµœì¢… ìŠ¤ì½”ì–´ -->
                        <div class="flex items-center space-x-4">
                            <span class="text-4xl font-extrabold text-gray-900">${totalScore}</span>
                            <span class="text-xl text-gray-500">íƒ€</span>
                        </div>
                        
                        <!-- ê²°ê³¼ ë©”ì‹œì§€ (Diff Pill ìŠ¤íƒ€ì¼ ì¬ì‚¬ìš©) -->
                        <div class="flex items-center justify-center">
                            <div class="text-lg font-bold rounded-full py-1 px-4 ${scoreMsg.colorClass} leading-none shadow">
                                ${scoreMsg.text} (${scoreMsg.diffText})
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        
        /**
         * ìŠ¤ì½”ì–´ ê¸°ë¡ ëª¨ë‹¬ì„ ì—½ë‹ˆë‹¤.
         * @param {number} index - í¸ì§‘í•  í™€ì˜ 0-based ì¸ë±ìŠ¤ (0-17)
         */
        window.openScoreModal = function(index) {
            window.currentHoleIndex = index;
            const holeData = window.scorecard[index];
            
            if (!holeData) return;
            
            document.getElementById('modal_hole_title').innerText = `${holeData.hole}ë²ˆ í™€ ê¸°ë¡`;
            
            // ë°ì´í„° ë¡œë“œ
            loadScoreDataToModal(index);

            // ëª¨ë‹¬ í‘œì‹œ
            document.getElementById('score_modal').classList.remove('hidden');
            document.getElementById('modal_backdrop').classList.remove('hidden');
        }
        
        /**
         * í˜„ì¬ í¸ì§‘ ì¤‘ì¸ í™€ì˜ ë°ì´í„°ë¥¼ ëª¨ë‹¬ì— ë¡œë“œí•©ë‹ˆë‹¤.
         */
        function loadScoreDataToModal(index) {
            const holeData = window.scorecard[index];
            if (!holeData) return;
            
            // 1. Par ì„ íƒ ë¡œë“œ
            const targetPar = holeData.par || initialHoleData[index].par;
            const targetButton = document.querySelector(`#modal_par_selector button[data-par="${targetPar}"]`);
            
            // Par ë²„íŠ¼ì„ ì°¾ì•„ ì„ íƒ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸í•©ë‹ˆë‹¤.
            // targetButtonì´ nullì¼ ìˆ˜ ìˆìœ¼ë¯€ë¡œ, selectPar ë‚´ë¶€ì—ì„œ ì²˜ë¦¬í•˜ë„ë¡ í•©ë‹ˆë‹¤.
            window.selectPar(targetPar, targetButton);


            // 2. ì¹´ìš´í„° ê°’ ë¡œë“œ
            document.getElementById('strokes_non_putt_count').innerText = holeData.strokesNonPutt || 0;
            document.getElementById('putts_count').innerText = holeData.putts || 0;
            document.getElementById('penalty_1x_count').innerText = holeData.penalty1x || 0;
            document.getElementById('penalty_2x_count').innerText = holeData.penalty2x || 0;
            
            // 3. ìµœì¢… ê³„ì‚° ë° ê²°ê³¼ í‘œì‹œ
            calculateScore(); 
        }

        /**
         * ëª¨ë‹¬ì„ ë‹«ìŠµë‹ˆë‹¤.
         */
        window.closeScoreModal = function() {
            document.getElementById('score_modal').classList.add('hidden');
            document.getElementById('modal_backdrop').classList.add('hidden');
            window.currentHoleIndex = -1; // ì¸ë±ìŠ¤ ì´ˆê¸°í™”
        }

        /**
         * ê³„ì‚°ëœ ìŠ¤ì½”ì–´ë¥¼ ìŠ¤ì½”ì–´ì¹´ë“œì— ì ìš©í•˜ê³  Local Storageì— ì €ì¥í•©ë‹ˆë‹¤.
         */
        window.applyScore = function() {
            if (window.currentHoleIndex === -1) return;

            const applyButton = document.getElementById('apply_score_button');
            const totalScore = parseInt(applyButton.getAttribute('data-score')) || 0;
            const par = parseInt(applyButton.getAttribute('data-par')) || 0;
            const strokes = parseInt(applyButton.getAttribute('data-strokes')) || 0;
            const putts = parseInt(applyButton.getAttribute('data-putts')) || 0;
            const p1x = parseInt(applyButton.getAttribute('data-p1x')) || 0;
            const p2x = parseInt(applyButton.getAttribute('data-p2x')) || 0;

            if (totalScore > 0) {
                // í˜„ì¬ ìƒíƒœ ì—…ë°ì´íŠ¸
                const updatedScorecard = [...window.scorecard];
                updatedScorecard[window.currentHoleIndex] = {
                    ...updatedScorecard[window.currentHoleIndex],
                    par: par,
                    score: totalScore,
                    strokesNonPutt: strokes,
                    putts: putts,
                    penalty1x: p1x,
                    penalty2x: p2x,
                };
                window.scorecard = updatedScorecard;

                // Local Storageì— ì €ì¥
                saveScorecardToLocalStorage();

                // UI ì—…ë°ì´íŠ¸
                renderScorecard18Holes(); 

                // ëª¨ë‹¬ ë‹«ê¸°
                closeScoreModal();
            } else {
                 console.error("ì ìš©í•  ìœ íš¨í•œ ì ìˆ˜ê°€ ì—†ìŠµë‹ˆë‹¤.");
            }
        }

        // ì´ˆê¸°í™”
        window.onload = function() {
            loadScorecardFromLocalStorage(); // ë°ì´í„° ë¡œë“œ
            renderScorecard18Holes(); // UI ë Œë”ë§ (18í™€)
        };

    </script>
</head>
<body class="bg-light-gray min-h-screen p-4 flex flex-col items-center">

    <div class="w-full max-w-lg bg-white rounded-xl shadow-2xl overflow-hidden ring-4 ring-golf-green/20 mb-6">
        
        <!-- Header -->
        <div class="bg-dark-green p-4 text-white">
            <h1 class="text-xl font-bold text-center flex items-center justify-center">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6 mr-2">
                    <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"></path>
                    <path d="M12 18v-6l-4 4"></path>
                    <path d="M12 6v6l4-4"></path>
                </svg>
                ê³¨í”„ ìŠ¤ì½”ì–´ ê¸°ë¡í‘œ (18í™€) V12
            </h1>
            <p class="text-xs text-center opacity-80 mt-1">ìŠ¤ì½”ì–´ë¥¼ í„°ì¹˜í•˜ì—¬ ê¸°ë¡/ìˆ˜ì •í•˜ì„¸ìš”.</p>
        </div>

        <!-- Single Unified Scorecard Table -->
        <div class="p-0 overflow-x-auto">
            <table class="scorecard-table">
                <thead>
                    <tr class="bg-gray-100 font-semibold text-gray-700">
                        <th class="w-[10%]">Hole</th>
                        <th class="w-[15%]">Par</th>
                        <th class="w-[30%]">Score</th>
                        <th class="w-[35%]">Diff</th>
                    </tr>
                </thead>
                <tbody id="scorecard_body">
                    <!-- 18 Hole rows, section dividers, and totals will be rendered here by JavaScript -->
                    <tr><td colspan="4" class="text-center py-4 text-gray-500">ìŠ¤ì½”ì–´ ë¡œë“œ ì¤‘...</td></tr>
                </tbody>
            </table>
        </div>

        <!-- Grand Totals Display - ìˆœ íƒ€ìˆ˜ ê°•ì¡° ìµœì í™” ì ìš© -->
        <div id="scorecard_totals">
            <!-- Grand Totals will be displayed here -->
        </div>
    </div>


    <!-- ========================================================================= -->
    <!-- Score Input Modal -->
    <!-- ========================================================================= -->

    <!-- Backdrop -->
    <div id="modal_backdrop" class="hidden fixed inset-0 bg-black bg-opacity-50 z-40 transition-opacity duration-300" onclick="closeScoreModal()"></div>

    <!-- Modal Content -->
    <div id="score_modal" class="hidden fixed inset-0 flex items-center justify-center p-4 z-50">
        <div class="w-full max-w-md bg-white rounded-xl shadow-2xl overflow-hidden transform transition-all duration-300">
            
            <!-- Modal Header -->
            <div class="bg-dark-green p-4 flex justify-between items-center text-white">
                <h2 id="modal_hole_title" class="text-xl font-bold">Në²ˆ í™€ ê¸°ë¡</h2>
                <button onclick="closeScoreModal()" class="text-white hover:text-gray-200 p-1 rounded-full transition-colors" aria-label="ëª¨ë‹¬ ë‹«ê¸°">
                    <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
                </button>
            </div>

            <div class="p-6 space-y-6 max-h-[80vh] overflow-y-auto">

                <!-- Par Input: Button Selector -->
                <div class="border-b pb-4 mb-4">
                    <label class="block text-sm font-semibold text-gray-700 mb-3">
                        ğŸ“Œ í™€ì˜ ê¸°ì¤€ íƒ€ìˆ˜ (Par) - í˜„ì¬: <span id="modal_current_par_display" class="font-bold text-dark-green">4</span>
                    </label>
                    <!-- grid-cols-4ë¡œ ë³€ê²½ ë° Par 6 ë²„íŠ¼ ìœ ì§€ -->
                    <div id="modal_par_selector" data-selected-par="4" class="grid grid-cols-4 gap-2 mt-1">
                        <button onclick="selectPar(3, this)" data-par="3" class="par-button py-3 rounded-xl text-xl font-bold border-2 transition duration-150 bg-gray-100 hover:bg-gray-200 shadow-md">Par 3</button>
                        <button onclick="selectPar(4, this)" data-par="4" class="par-button py-3 rounded-xl text-xl font-bold border-2 transition duration-150 bg-gray-100 hover:bg-gray-200 shadow-md">Par 4</button>
                        <button onclick="selectPar(5, this)" data-par="5" class="par-button py-3 rounded-xl text-xl font-bold border-2 transition duration-150 bg-gray-100 hover:bg-gray-200 shadow-md">Par 5</button>
                        <button onclick="selectPar(6, this)" data-par="6" class="par-button py-3 rounded-xl text-xl font-bold border-2 transition duration-150 bg-gray-100 hover:bg-gray-200 shadow-md">Par 6</button>
                    </div>
                     <p class="text-xs text-gray-500 mt-2 text-center">ì„ íƒëœ Par ê°’ìœ¼ë¡œ ìŠ¤ì½”ì–´ ê²°ê³¼ê°€ ê³„ì‚°ë©ë‹ˆë‹¤.</p>
                </div>

                <!-- ìŠ¤íŠ¸ë¡œí¬ ì…ë ¥ ê·¸ë£¹ -->
                <div class="bg-green-50 p-4 rounded-xl shadow-md border border-green-200">
                    <h3 class="text-lg font-bold text-dark-green pb-3">1. ì‹¤ì œ ìŠ¤íŠ¸ë¡œí¬ íšŸìˆ˜</h3>
                    
                    <!-- ì¹´ìš´í„°: ì½”ìŠ¤ ìƒ· -->
                    <label class="block mb-4">
                        <span class="block text-base font-medium text-gray-700 mb-1">â‘  ì½”ìŠ¤ ìƒ· (í¼íŒ… ì œì™¸)</span>
                        <div class="mt-1 flex items-center justify-between bg-white rounded-xl border-2 border-gray-300 shadow-lg overflow-hidden">
                            <button onclick="changeCount('strokes_non_putt', -1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-red-100 hover:bg-red-200 text-red-600 transition duration-150 w-1/4 rounded-r-none">-</button>
                            <span id="strokes_non_putt_count" class="text-4xl font-extrabold text-gray-900 w-2/4 text-center">0</span>
                            <button onclick="changeCount('strokes_non_putt', 1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-golf-green/20 hover:bg-golf-green/30 text-dark-green transition duration-150 w-1/4 rounded-l-none">+</button>
                        </div>
                    </label>

                    <!-- ì¹´ìš´í„°: í¼íŒ… íšŸìˆ˜ -->
                    <label class="block">
                        <span class="block text-base font-medium text-gray-700 mb-1">â‘¡ ì´ í¼íŒ… íšŸìˆ˜</span>
                        <div class="mt-1 flex items-center justify-between bg-white rounded-xl border-2 border-gray-300 shadow-lg overflow-hidden">
                            <button onclick="changeCount('putts', -1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-red-100 hover:bg-red-200 text-red-600 transition duration-150 w-1/4 rounded-r-none">-</button>
                            <span id="putts_count" class="text-4xl font-extrabold text-gray-900 w-2/4 text-center">0</span>
                            <button onclick="changeCount('putts', 1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-golf-green/20 hover:bg-golf-green/30 text-dark-green transition duration-150 w-1/4 rounded-l-none">+</button>
                        </div>
                    </label>
                </div>

                <!-- ë²Œíƒ€ ì…ë ¥ ê·¸ë£¹ -->
                <div class="bg-red-50 p-4 rounded-xl shadow-md border border-red-200">
                    <h3 class="text-lg font-bold text-red-600 pb-3">2. ì´ ë²Œíƒ€ íšŸìˆ˜</h3>
                    
                    <!-- ì¹´ìš´í„°: 1ë²Œíƒ€ ìƒí™© -->
                    <label class="block mb-4">
                        <span class="block text-base font-medium text-gray-700 mb-1">â‘  1ë²Œíƒ€ (ì›Œí„° í•´ì €ë“œ, OB ë“±)</span>
                        <div class="mt-1 flex items-center justify-between bg-white rounded-xl border-2 border-gray-300 shadow-lg overflow-hidden">
                            <button onclick="changeCount('penalty_1x', -1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-red-100 hover:bg-red-200 text-red-600 transition duration-150 w-1/4 rounded-r-none">-</button>
                            <span id="penalty_1x_count" class="text-4xl font-extrabold text-gray-900 w-2/4 text-center">0</span>
                            <button onclick="changeCount('penalty_1x', 1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-golf-green/20 hover:bg-golf-green/30 text-dark-green transition duration-150 w-1/4 rounded-l-none">+</button>
                        </div>
                    </label>

                    <!-- ì¹´ìš´í„°: 2ë²Œíƒ€ ìƒí™© -->
                    <label class="block">
                        <span class="block text-base font-medium text-gray-700 mb-1">â‘¡ 2ë²Œíƒ€ (ë“œë¡­ ì—†ëŠ” OB ë“±)</span>
                        <div class="mt-1 flex items-center justify-between bg-white rounded-xl border-2 border-gray-300 shadow-lg overflow-hidden">
                            <button onclick="changeCount('penalty_2x', -1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-red-100 hover:bg-red-200 text-red-600 transition duration-150 w-1/4 rounded-r-none">-</button>
                            <span id="penalty_2x_count" class="text-4xl font-extrabold text-gray-900 w-2/4 text-center">0</span>
                            <button onclick="changeCount('penalty_2x', 1)" class="counter-button flex items-center justify-center text-3xl font-bold p-3 bg-golf-green/20 hover:bg-golf-green/30 text-dark-green transition duration-150 w-1/4 rounded-l-none">+</button>
                        </div>
                    </label>
                </div>
                
                <!-- Result Display -->
                <div id="modal_result_message" class="p-4 bg-light-gray rounded-xl">
                    <!-- ê³„ì‚° ê²°ê³¼ê°€ ì—¬ê¸°ì— í‘œì‹œë©ë‹ˆë‹¤. -->
                </div>
            </div>

            <!-- Modal Footer -->
            <div class="p-4 bg-gray-100 flex justify-end space-x-3 border-t">
                <button onclick="closeScoreModal()" class="px-4 py-2 bg-gray-200 text-gray-800 font-semibold rounded-lg hover:bg-gray-300 transition-colors">
                    ì·¨ì†Œ
                </button>
                <button id="apply_score_button" onclick="applyScore()" data-score="0" class="px-6 py-2 bg-golf-green text-white font-bold rounded-lg hover:bg-dark-green transition-colors disabled:opacity-50" disabled>
                    ìŠ¤ì½”ì–´ ì ìš© (0íƒ€)
                </button>
            </div>
        </div>
    </div>

</body>
</html>