<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸ˜‚ ì¦ê±°ìš´ ìš´ëª… ë½‘ê¸° ê²Œì„</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* Inter í°íŠ¸ ì‚¬ìš© */
        body { font-family: 'Inter', sans-serif; background-color: #f7f9fb; }
        /* ì¼ë°˜ ë²„íŠ¼ ìŠ¤íƒ€ì¼ */
        .btn-base {
            transition: all 0.1s ease-in-out;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        .btn-base:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 8px rgba(0, 0, 0, 0.15);
        }
        .btn-base:active:not(:disabled) {
            transform: translateY(1px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .btn-base:disabled {
            background-color: #d1d5db !important;
            color: #6b7280 !important;
            cursor: not-allowed;
            box-shadow: none;
        }
        /* Primary (Draw/Raffle) Button Style - ìš©ì–´ ë³€ê²½ì— ë§ì¶° ìƒ‰ìƒ ìœ ì§€ */
        .btn-primary {
            background: linear-gradient(145deg, #4f46e5, #4338ca);
            color: white;
            font-weight: bold;
        }
        /* Secondary (Tee-Off Order) Button Style */
        .btn-secondary {
            background-color: #10b981; /* Green color */
            color: white;
            font-weight: bold;
        }
        /* Danger (End Game) Button Style */
        .btn-danger {
            background-color: #ef4444; /* Red color */
            color: white;
            font-weight: bold;
        }
        .team-box {
            background-color: #ffffff;
            padding: 1rem;
            border-radius: 0.75rem;
            text-align: center;
            font-size: 1.5rem;
            font-weight: 800;
            min-height: 5rem; /* ì• ë‹ˆë©”ì´ì…˜ ì¤‘ ë†’ì´ ìœ ì§€ë¥¼ ìœ„í•´ ìµœì†Œ ë†’ì´ ì„¤ì • */
            display: flex;
            flex-direction: column; /* ì œëª©ê³¼ í”„ë¡œ ëª©ë¡ì„ ì„¸ë¡œë¡œ ì •ë ¬ */
            align-items: center;
            justify-content: center;
        }
        /* Team Selection base style */
        .team-selector {
            border-width: 2px;
            box-shadow: 0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06);
            transition: all 0.2s ease-in-out;
        }
        /* Team 1 Selected Style */
        .team-selected-win {
            border-color: #ef4444 !important; /* Red border for T1 win */
            background-color: #fee2e2 !important; /* Light red background */
            box-shadow: 0 10px 15px -3px rgba(239, 68, 68, 0.3), 0 4px 6px -2px rgba(239, 68, 68, 0.1) !important;
            transform: scale(1.02);
        }
        /* Team 2 Selected Style */
        .team-selected-loss {
            border-color: #3b82f6 !important; /* Blue border for T2 win */
            background-color: #dbeafe !important; /* Light blue background */
            box-shadow: 0 10px 15px -3px rgba(59, 130, 246, 0.3), 0 4px 6px -2px rgba(59, 130, 246, 0.1) !important;
            transform: scale(1.02);
        }

        /* --- í™€ ë²„íŠ¼ ìŠ¤íƒ€ì¼ --- */
        .hole-btn {
            padding: 0.5rem 0.2rem;
            width: 15%; 
            min-width: 40px;
            font-size: 0.7rem;
            font-weight: 600;
            border-radius: 0.5rem;
            transition: all 0.1s;
            border: 1px solid #d1d5db; /* ê¸°ë³¸ í…Œë‘ë¦¬ */
        }
        
        /* ğŸ”¥ í˜„ì¬ ë³´ì—¬ì£¼ëŠ” í™€ (Active) - ì¸ë””ê³  ê³„ì—´ë¡œ ì‹œê°ì  ê°•ì¡° ê·¹ëŒ€í™” */
        .hole-active {
            background-color: #eef2ff !important; /* Light indigo background */
            border-color: #6366f1 !important; /* Strong indigo border */
            outline: 4px solid #4f46e5 !important; /* Primary indigo color for strong outline */
            outline-offset: 2px;
            box-shadow: 0 0 16px rgba(79, 70, 229, 0.9) !important; /* Strong blue/indigo glow */
            transform: scale(1.08); /* Stronger zoom */
            color: #3730a3 !important; /* Darker text for contrast */
            font-weight: 800 !important;
        }

        /* íŒ€ 1 ìŠ¹ë¦¬ (ë ˆë“œ) */
        .score-win { background-color: #f87171; color: #7f1d1d; font-weight: bold; }
        /* íŒ€ 2 ìŠ¹ë¦¬ (ë¸”ë£¨) */
        .score-loss { background-color: #93c5fd; color: #1e40af; font-weight: bold; }
        /* ë™ì  (TIE) */
        .score-tie { background-color: #5eead4; color: #0f766e; font-weight: bold; }

        /* --- ê²°ê³¼ ì˜ì—­ Pulse ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€ --- */
        @keyframes pulse-draw {
            0% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
            50% { transform: scale(1.01); box-shadow: 0 0 25px rgba(79, 70, 229, 0.7); }
            100% { transform: scale(1); box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05); }
        }

        .result-pulse {
            animation: pulse-draw 0.5s ease-out 1;
        }

        /* --- íŒ€ ë½‘ê¸° ì• ë‹ˆë©”ì´ì…˜ ìŠ¤íƒ€ì¼ (ì†ë„ ì¡°ì •ë¨) --- */
        @keyframes shuffle-name {
            0% { opacity: 0.3; transform: translateY(10px) scale(0.9); }
            50% { opacity: 1; transform: translateY(0px) scale(1); }
            100% { opacity: 0.3; transform: translateY(-10px) scale(0.9); }
        }
        .shuffling-name {
            display: inline-block;
            /* ì• ë‹ˆë©”ì´ì…˜ ì†ë„ë¥¼ 0.15ì´ˆë¡œ ëŠ˜ë ¤ ë³´í†µ ì†ë„ë¡œ ì¡°ì • */
            animation: shuffle-name 0.15s infinite cubic-bezier(0.4, 0, 0.2, 1);
        }

        /* --- ë©”ì‹œì§€ ë°•ìŠ¤ ìŠ¤íƒ€ì¼ (í•˜ë‹¨ ê³ ì •) --- */
        .fixed-message-box {
            position: fixed;
            bottom: 0; /* í™”ë©´ í•˜ë‹¨ì— ê³ ì • */
            left: 0;
            width: 100%;
            padding: 1rem;
            text-align: center;
            font-weight: bold;
            box-shadow: 0 -4px 12px rgba(0, 0, 0, 0.15);
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transform: translateY(100%);
            transition: opacity 0.3s, visibility 0.3s, transform 0.3s;
        }
        .fixed-message-box.open {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }


        /* --- ëª¨ë‹¬ ìŠ¤íƒ€ì¼ (ë³€ê²½ ì—†ìŒ) --- */
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.3s, visibility 0.3s;
        }
        .modal-overlay.open {
            opacity: 1;
            visibility: visible;
        }
        .modal-content {
            background-color: white;
            padding: 1.5rem;
            border-radius: 1rem;
            max-width: 90%;
            max-height: 90%;
            overflow-y: auto;
            position: relative;
            transform: translateY(-50px);
            transition: transform 0.3s ease-out;
        }
        .modal-overlay.open .modal-content {
            transform: translateY(0);
        }
        .result-grid-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem;
            border-radius: 0.5rem;
            margin-bottom: 0.5rem;
            font-size: 0.875rem;
            font-weight: 600;
        }
        /* í”„ë¡œ ì…ë ¥ ë°•ìŠ¤ í°íŠ¸ í¬ê¸° ì¡°ì • */
        .player-input-field::placeholder {
            font-size: 0.75rem; /* Placeholder í°íŠ¸ í¬ê¸° ì¤„ì„ */
            color: #9ca3af; /* íšŒìƒ‰ìœ¼ë¡œ ì¡°ì • */
        }

    </style>
</head>
<body class="p-4 sm:p-8">
    <div id="app" class="max-w-xl mx-auto bg-white p-6 rounded-2xl shadow-2xl border border-gray-100">

        <!-- Header -->
        <header class="text-center mb-6">
            <h1 class="text-3xl font-extrabold text-gray-900 mb-1">ğŸ˜‚ ì¦ê±°ìš´ ìš´ëª… ë½‘ê¸° ê²Œì„</h1>
        </header>

        <!-- --- ê²Œì„ ì„¤ì • ì˜ì—­ (Initial State) --- -->
        <div id="setup-area">
             <!-- Pro Input (4ê°œ ì…ë ¥ ë°•ìŠ¤ë¡œ ë³€ê²½ë¨) -->
            <div class="mb-4 p-4 bg-gray-50 rounded-xl border border-gray-200">
                <div class="flex justify-between items-center mb-2">
                    <label class="block text-sm font-bold text-gray-700">
                        í”„ë¡œ ì´ë¦„ ì…ë ¥ (ì´ 4ëª…)
                    </label>
                    <button onclick="resetPlayerInputs()" 
                            class="text-xs font-semibold text-gray-500 hover:text-red-500 transition duration-150">
                        [ì…ë ¥ ì´ˆê¸°í™”]
                    </button>
                </div>
                
                <div id="player-inputs-container" class="grid grid-cols-2 gap-3">
                    <input type="text" id="player-input-1" placeholder="ë‹¹ì‹ ì€ê³¨í”„ì™•" oninput="updatePlayerList()" 
                           class="player-input-field w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out font-medium text-gray-800 text-center" />
                    <input type="text" id="player-input-2" placeholder="10ë…„ë°±ëŒì´" oninput="updatePlayerList()" 
                           class="player-input-field w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out font-medium text-gray-800 text-center" />
                    <input type="text" id="player-input-3" placeholder="ë³´ê¸°í”Œë ˆì´ì–´" oninput="updatePlayerList()" 
                           class="player-input-field w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out font-medium text-gray-800 text-center" />
                    <input type="text" id="player-input-4" placeholder="ë‚˜ëŠ”ë²„ë””í‚¹" oninput="updatePlayerList()" 
                           class="player-input-field w-full p-2 border border-gray-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500 transition duration-150 ease-in-out font-medium text-gray-800 text-center" />
                </div>
                
                <div id="player-list-display" class="mt-3 text-sm font-semibold text-gray-600">
                    <!-- Updated by JS -->
                </div>
            </div>

            <!-- Tee-Off Order Selection (with Shuffle Count) -->
            <div class="mb-4 p-4 bg-green-50 rounded-xl border border-green-200">
                <label class="block text-sm font-bold text-gray-700 mb-2">
                    1. ë¼ìš´ë“œ íƒ€ìˆœ ê²°ì •
                </label>
                <div class="mb-3 flex items-center justify-center space-x-2">
                    <label for="shuffle-count-input" class="text-sm font-medium text-gray-700">íƒ€ìˆœ ì„ê¸° íšŸìˆ˜:</label>
                    <input type="number" id="shuffle-count-input" value="10" min="1" max="50"
                           class="w-16 p-1 border border-gray-300 rounded-lg text-center font-bold focus:ring-green-500 focus:border-green-500">
                </div>
                <div id="tee-off-display" class="text-center text-xl font-extrabold text-green-700 mb-1 flex flex-col items-center justify-center min-h-[8rem]">
                    íƒ€ìˆœì„ ì •í•´ì£¼ì„¸ìš”!
                </div>
                <div id="tee-off-progress" class="text-center text-sm font-medium text-gray-600 mt-2 h-5 hidden"></div>
                
                <button id="tee-off-select-button" onclick="selectTeeOffOrder()" disabled
                        class="w-full btn-base btn-secondary py-3 rounded-xl text-lg shadow-md">
                    ğŸ² ë¼ìš´ë“œ íƒ€ìˆœ ìš´ëª… ë½‘ê¸°
                </button>
            </div>

            <!-- Joker Count Input -->
            <div class="mb-6 p-4 bg-yellow-50 rounded-xl border border-yellow-200">
                <label for="joker-count-input" class="block text-sm font-bold text-gray-700 mb-2">
                    2. ì¡°ì»¤(JOKER) í™œì„±í™” íšŸìˆ˜ (0~18í™€)
                </label>
                <input type="number" id="joker-count-input" value="5" min="0" max="18"
                       class="w-full p-3 border border-yellow-300 rounded-lg focus:ring-yellow-500 focus:border-yellow-500 transition duration-150 ease-in-out font-bold text-gray-800 text-center">
            </div>

            <!-- Start Button (onclick ìˆ˜ì •ë¨) -->
            <button id="start-game-button" onclick="handleStartGameConfirmation()" disabled
                    class="w-full btn-base btn-primary py-3 rounded-xl text-lg mb-6 shadow-md">
                3. ë½‘ê¸° ê²Œì„ ì‹œì‘!
            </button>
        </div>

        <!-- --- ê²Œì„ ì§„í–‰ ì˜ì—­ (In-Game State) --- -->
        <div id="game-area" class="hidden">
            <!-- Current Status -->
            <div class="flex justify-between items-center bg-indigo-50 p-4 rounded-xl mb-6 shadow-inner">
                <div class="text-left">
                    <p class="text-lg font-bold text-indigo-700">ë‹¤ìŒ í™€:</p>
                    <p id="current-hole-display" class="text-4xl font-extrabold text-indigo-900">N/A</p>
                </div>
                <div class="text-right">
                    <p class="text-sm font-semibold text-gray-600">ë‚¨ì€ ì¡°ì»¤:</p>
                    <p id="joker-remaining" class="text-xl font-bold text-red-700">N/A</p>
                </div>
            </div>

            <!-- Hole Buttons (1-18) - ì „/í›„ë°˜ êµ¬ë¶„ -->
            <div id="hole-buttons-container" class="mb-6 p-4 bg-gray-100 rounded-xl border border-gray-200">
                <p class="text-sm font-bold text-gray-700 mb-4 text-center">â›³ï¸ 18í™€ ê²°ê³¼ ë³´ê¸° ë° ìˆ˜ì • (í´ë¦­)</p>
                
                <!-- ì „ë°˜ (Front Nine: 1-9) -->
                <div class="mb-4 p-3 bg-white rounded-lg shadow-md border border-gray-200">
                    <h3 class="text-lg font-extrabold text-gray-800 mb-2 text-center border-b pb-2">FRONT 9 (1~9í™€)</h3>
                    <div id="hole-buttons-front" class="flex flex-wrap gap-1.5 justify-center">
                        <!-- 1-9 Buttons will be generated here -->
                    </div>
                </div>

                <!-- í›„ë°˜ (Back Nine: 10-18) -->
                 <div class="p-3 bg-white rounded-lg shadow-md border border-gray-200">
                    <h3 class="text-lg font-extrabold text-gray-800 mb-2 text-center border-b pb-2">BACK 9 (10~18í™€)</h3>
                    <div id="hole-buttons-back" class="flex flex-wrap gap-1.5 justify-center">
                        <!-- 10-18 Buttons will be generated here -->
                    </div>
                </div>

            </div>
            
            <!-- Control Buttons (Draw & End Game) -->
            <div class="flex space-x-4 mb-4">
                <!-- ë“œë¡œìš° ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì • -->
                <button id="next-draw-button" onclick="handleDraw()" disabled
                        class="w-3/4 btn-base btn-primary py-3 rounded-xl text-lg shadow-md">
                    ğŸ¤ íŒ€ ë½‘ê¸° ì‹œì‘!
                </button>
                <button id="end-game-button" onclick="showFinalSummary()"
                        class="w-1/4 btn-base btn-danger py-3 rounded-xl text-lg shadow-md">
                    ê²°ê³¼ ìš”ì•½
                </button>
            </div>
            
            <!-- NEW: Reset Button in Game Area -->
            <button id="main-reset-button" onclick="handleResetConfirmation();"
                    class="w-full btn-base bg-gray-300 text-gray-800 py-3 rounded-xl text-lg shadow-md hover:bg-gray-400 transition mb-6">
                â†©ï¸ ê²Œì„ ì´ˆê¸°í™” ë° ì¬ì‹œì‘
            </button>


            <!-- Result Display -->
            <div id="result-area" class="mt-4 p-4 border border-indigo-300 bg-white rounded-xl shadow-inner hidden">
                <!-- ê²°ê³¼ ì œëª© ìˆ˜ì •: 'íŒ€ êµ¬ì„±' ê°•ì¡° -->
                <h2 class="text-xl font-bold text-indigo-800 mb-4 text-center">ğŸ† ìš´ëª…ì˜ <span id="result-hole-number"></span>í™€ íŒ€ êµ¬ì„±</h2>
                <div id="joker-status" class="text-center font-bold text-lg mb-4 p-2 rounded-lg"></div>

                <div class="flex flex-col sm:flex-row justify-center items-center space-y-4 sm:space-y-0 sm:space-x-4">
                    <!-- Team 1 Box - Clickable for scoring -->
                    <div id="team1-players" 
                         onclick="toggleWinningTeam(1)"
                         class="team-box team-selector border-red-400 text-red-700 w-full sm:w-1/2 cursor-pointer transition duration-150 ease-in-out hover:shadow-lg">
                    </div>
                    <div class="text-3xl font-extrabold text-gray-400">VS</div>
                    <!-- Team 2 Box - Clickable for scoring -->
                    <div id="team2-players" 
                         onclick="toggleWinningTeam(2)"
                         class="team-box team-selector border-blue-400 text-blue-700 w-full sm:w-1/2 cursor-pointer transition duration-150 ease-in-out hover:shadow-lg">
                    </div>
                </div>

                <!-- ë“œë¡œìš° ìƒì„¸ í…ìŠ¤íŠ¸ ìˆ˜ì • -->
                <p id="draw-details" class="text-sm text-gray-600 mt-4 pt-3 border-t border-gray-200 text-center"></p>

                <!-- Score Input Area (Custom Clickable Boxes) -->
                <div id="score-input-area" class="mt-6 p-4 bg-gray-50 rounded-lg border border-gray-200">
                    
                    <!-- Score status feedback (ë¬¸êµ¬ ìˆ˜ì •) -->
                    <p id="score-status" class="mt-2 text-sm text-center font-semibold text-indigo-700">
                        íŒ€ì„ í´ë¦­í•˜ì—¬ ìŠ¹ë¦¬ íŒ€ì„ ì„ íƒí•˜ì„¸ìš” (ë¯¸ì„ íƒ ì‹œ ë™ì )
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- --- ê²°ê³¼ ìš”ì•½ ëª¨ë‹¬ ì°½ (ë³€ê²½ ì—†ìŒ) --- -->
    <div id="results-modal" class="modal-overlay">
        <div class="modal-content w-full sm:max-w-xl">
            <button class="absolute top-3 right-3 text-gray-500 hover:text-gray-900 text-2xl font-bold" onclick="closeModal()">
                &times;
            </button>
            <h2 class="text-2xl font-extrabold text-gray-900 mb-4 border-b pb-2 text-center">ë¼ìš´ë“œ ìµœì¢… ê²°ê³¼ ìš”ì•½</h2>
            <!-- ìµœì¢… ê²°ê³¼ ìš”ì•½ í…Œì´ë¸”ì„ ìœ„í•œ ìŠ¤íƒ€ì¼ ì¡°ì • -->
            <div id="final-results-summary" class="grid grid-cols-2 gap-3 sm:grid-cols-3 sm:gap-4">
                <!-- Hole results will be inserted here -->
            </div>
            <p id="game-summary-message" class="mt-6 p-3 text-center text-md font-semibold rounded-lg bg-yellow-100 text-yellow-800"></p>
            
            <!-- ìƒˆë¡œ ì¶”ê°€ëœ ìƒˆ ê²Œì„ ì‹œì‘ ë²„íŠ¼ -->
            <button onclick="handleResetConfirmation(); closeModal();"
                    class="mt-4 w-full btn-base btn-primary py-3 rounded-xl text-lg shadow-md">
                ìƒˆ ê²Œì„ ì‹œì‘ (ê²Œì„ ì´ˆê¸°í™”)
            </button>
        </div>
    </div>
    
    <!-- --- ê²Œì„ ì‹œì‘ í™•ì¸ ëª¨ë‹¬ ì°½ (ìƒˆë¡œ ì¶”ê°€ë¨) --- -->
    <div id="confirm-modal" class="modal-overlay">
        <div class="modal-content w-full sm:max-w-xs p-6">
            <h3 id="confirm-title" class="text-xl font-bold text-gray-900 mb-4 text-center">í™•ì¸</h3>
            <p id="confirm-message" class="text-gray-700 mb-6 text-center"></p>
            <div class="flex justify-center space-x-4">
                <button id="confirm-yes-button" 
                        class="w-1/2 btn-base btn-primary py-2 rounded-xl text-lg shadow-md">
                    í™•ì¸
                </button>
                <button onclick="closeConfirmModal()"
                        class="w-1/2 btn-base bg-gray-300 text-gray-800 py-2 rounded-xl text-lg shadow-md hover:bg-gray-400">
                    ì·¨ì†Œ
                </button>
            </div>
        </div>
    </div>
    
    <!-- --- í•˜ë‹¨ ê³ ì • ë©”ì‹œì§€ ì˜ì—­ --- -->
    <div id="global-message-box" class="fixed-message-box bg-white border-t border-gray-300"></div>

    <script>
        // =======================================================
        // 1. í•µì‹¬ ìƒìˆ˜ ì •ì˜ (ìœ ì§€ë³´ìˆ˜ ìš©ì´ì„±ì„ ìœ„í•´ ë¶„ë¦¬)
        // =======================================================
        const MAX_HOLES = 18;
        const TEAM_SCORE = {
            RED_WIN: 'WIN',
            BLUE_WIN: 'LOSS',
            TIE: 'TIE'
        };
        const TEAM_COLORS = {
            1: 'RED TEAM',
            2: 'BLUE TEAM'
        };
        const DRAW_STICKS = {
            RED: 'R',
            BLUE: 'B',
            JOKER: 'J'
        };
        const PLAYER_INPUT_IDS = ['player-input-1', 'player-input-2', 'player-input-3', 'player-input-4'];

        // --- ê²Œì„ ìƒíƒœ ë³€ìˆ˜ ---
        let currentHole = 0; // 0: ê²Œì„ ì¤€ë¹„, 1~18: ë‹¤ìŒì— ë½‘ê¸°í•  í™€ ë²ˆí˜¸
        let currentPlayers = [];
        let teeOffOrder = []; 
        let jokerSchedule = [];
        // holeResultsì˜ score í•„ë“œëŠ” TEAM_SCORE ìƒìˆ˜ë¥¼ ì‚¬ìš©
        let holeResults = []; // ê° í™€ì˜ íŒ€ êµ¬ì„± ë° ìŠ¤ì½”ì–´ ê²°ê³¼ë¥¼ ì €ì¥í•˜ëŠ” ë°°ì—´ (0~17 ì¸ë±ìŠ¤)
        
        // --- ìœ í‹¸ë¦¬í‹° í•¨ìˆ˜ ---

        /**
         * ë°°ì—´ì„ ë¬´ì‘ìœ„ë¡œ ì„ìŠµë‹ˆë‹¤. (Fisher-Yates shuffle)
         */
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1)); 
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        /**
         * ê²½ê³  ë©”ì‹œì§€ë¥¼ ì‚¬ìš©ìì—ê²Œ í‘œì‹œí•©ë‹ˆë‹¤. (alert ëŒ€ì²´)
         */
        function showMessage(text, type = 'blue') {
            const messageBox = document.getElementById('global-message-box');
            messageBox.textContent = text;
            
            // í´ë˜ìŠ¤ ì´ˆê¸°í™”
            messageBox.className = 'fixed-message-box';
            
            let bgColor, textColor, borderColor;
            switch (type) {
                case 'red':
                    bgColor = 'bg-red-100';
                    textColor = 'text-red-800';
                    borderColor = 'border-red-300';
                    break;
                case 'green':
                    bgColor = 'bg-green-100';
                    textColor = 'text-green-800';
                    borderColor = 'border-green-300';
                    break;
                case 'yellow':
                    bgColor = 'bg-yellow-100';
                    textColor = 'text-yellow-800';
                    borderColor = 'border-yellow-300';
                    break;
                case 'indigo':
                default:
                    bgColor = 'bg-indigo-100';
                    textColor = 'text-indigo-800';
                    borderColor = 'border-indigo-300';
                    break;
            }

            messageBox.classList.add('open', bgColor, textColor, borderColor);
            
            // 3ì´ˆ í›„ ì‚¬ë¼ì§€ë„ë¡ ì„¤ì •
            setTimeout(() => {
                messageBox.classList.remove('open');
            }, 3000);
        }
        
        /**
         * ë¹„ë™ê¸° ë”œë ˆì´ë¥¼ ìœ„í•œ Promise ê¸°ë°˜ í•¨ìˆ˜
         */
        const delay = (ms) => new Promise(resolve => setTimeout(resolve, ms));


        // --- í”„ë¡œ ë° UI ê´€ë¦¬ í•¨ìˆ˜ ---

        /**
         * 4ê°œì˜ ì…ë ¥ ë°•ìŠ¤ì—ì„œ í”„ë¡œ ì´ë¦„ì„ ê°€ì ¸ì™€ ìœ íš¨ì„±ì„ ê²€ì‚¬í•©ë‹ˆë‹¤.
         */
        function getPlayers() {
            let players = [];
            
            PLAYER_INPUT_IDS.forEach(id => {
                const inputElement = document.getElementById(id);
                if (inputElement) {
                    const name = inputElement.value.trim();
                    if (name) {
                        players.push(name);
                    }
                }
            });
            
            if (players.length !== 4) return null;
            
            // ì¤‘ë³µ ì œê±° ë° í™•ì¸
            const uniquePlayers = [...new Set(players)];
            if (uniquePlayers.length !== 4) return null;

            return uniquePlayers;
        }

        /**
         * í”„ë¡œ ì…ë ¥ ë°•ìŠ¤ë¥¼ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        function resetPlayerInputs() {
            PLAYER_INPUT_IDS.forEach(id => {
                const inputElement = document.getElementById(id);
                if (inputElement) {
                    inputElement.value = '';
                }
            });
            updatePlayerList();
            showMessage("âœ… í”„ë¡œ ì…ë ¥ë€ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤.", 'green');
        }

        /**
         * í”„ë¡œ ëª©ë¡ ë””ìŠ¤í”Œë ˆì´ë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  currentPlayersë¥¼ ì„¤ì •í•©ë‹ˆë‹¤.
         */
        function updatePlayerList() {
            const players = getPlayers();
            const displayElement = document.getElementById('player-list-display');
            
            const selectButton = document.getElementById('tee-off-select-button');
            const display = document.getElementById('tee-off-display');
            const startButton = document.getElementById('start-game-button');

            if (players) {
                currentPlayers = players;
                displayElement.innerHTML = `í˜„ì¬ í”„ë¡œ: <span class="text-indigo-600 font-extrabold">${players.join(', ')}</span> (4ëª… í™•ì¸ ì™„ë£Œ)`;
                
                // íƒ€ìˆœì´ ê²°ì •ë˜ì§€ ì•Šì•˜ê±°ë‚˜, ê²°ì •ëœ íƒ€ìˆœì´ í˜„ì¬ í”„ë¡œì™€ ì¼ì¹˜í•˜ì§€ ì•Šìœ¼ë©´ ì´ˆê¸°í™”
                if (teeOffOrder.length !== 4 || !teeOffOrder.every(p => players.includes(p))) {
                    teeOffOrder = [];
                    display.innerHTML = 'íƒ€ìˆœì„ ì •í•´ì£¼ì„¸ìš”!';
                    selectButton.textContent = 'ğŸ² ë¼ìš´ë“œ íƒ€ìˆœ ìš´ëª… ë½‘ê¸°';
                    startButton.disabled = true;
                }

                selectButton.disabled = false; // 4ëª… ì…ë ¥ë˜ë©´ íƒ€ìˆœ ê²°ì • í™œì„±í™”
            } else {
                 currentPlayers = [];
                 displayElement.innerHTML = `í˜„ì¬ í”„ë¡œ: <span class="text-red-600">4ëª…ì˜ ê³ ìœ í•œ í”„ë¡œ ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</span>`;
                 
                 // í”„ë¡œ ë¯¸ë‹¬ ì‹œ ëª¨ë“  í›„ì† ë²„íŠ¼ ë¹„í™œì„±í™”
                 selectButton.disabled = true;
                 startButton.disabled = true;
            }
        }
        
        /**
         * íƒ€ìˆœì„ ë¬´ì‘ìœ„ë¡œ ì •í•˜ê³  ì‹œê°ì ìœ¼ë¡œ ì…”í”Œë§ì„ ë³´ì—¬ì¤ë‹ˆë‹¤.
         */
        async function selectTeeOffOrder() {
            const players = getPlayers();
            if (!players || players.length !== 4) {
                 showMessage("ğŸš¨ 4ëª…ì˜ í”„ë¡œ ì´ë¦„ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.", 'red');
                 return;
            }
            
            // ìš”ì²­ ì‚¬í•­: íƒ€ìˆœ ë½‘ê¸° ì‹œì‘ ì‹œ ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìë™ ìŠ¤í¬ë¡¤
            const teeOffDisplay = document.getElementById('tee-off-display');
            teeOffDisplay.scrollIntoView({ behavior: 'smooth' });
            
            const shuffleCountInput = document.getElementById('shuffle-count-input');
            const shuffleCount = parseInt(shuffleCountInput.value, 10);
            if (shuffleCount < 1 || shuffleCount > 50) {
                 showMessage("ğŸš¨ ì„ê¸° íšŸìˆ˜ëŠ” 1ì—ì„œ 50 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.", 'red');
                 return;
            }
            
            const button = document.getElementById('tee-off-select-button');
            const display = document.getElementById('tee-off-display');
            const progress = document.getElementById('tee-off-progress');
            const startButton = document.getElementById('start-game-button');

            // ì…ë ¥ í•„ë“œ ë¹„í™œì„±í™” ì²˜ë¦¬
            PLAYER_INPUT_IDS.forEach(id => document.getElementById(id).disabled = true);
            document.getElementById('joker-count-input').disabled = true;
            button.disabled = true;
            shuffleCountInput.disabled = true;
            startButton.disabled = true;
            progress.classList.remove('hidden');

            const playersCopy = [...currentPlayers]; 

            // ì• ë‹ˆë©”ì´ì…˜ ì†ë„ë¥¼ ë³´í†µìœ¼ë¡œ ìœ ì§€ (10íšŒ ì„ê¸° ê¸°ì¤€ 1.5ì´ˆ)
            const animationDuration = 1500; 
            const totalDelay = animationDuration / shuffleCount;


            for (let i = 1; i <= shuffleCount; i++) {
                shuffleArray(playersCopy);
                
                const shuffleHtml = playersCopy.map((player, index) => 
                    `<p class="text-lg font-bold text-gray-700 mb-1">
                        ${index + 1}. <span class="text-gray-500">${player}</span>
                    </p>`
                ).join('');

                display.innerHTML = `<div class="flex flex-col items-center justify-center pt-2 pb-2">
                    <span class="text-sm text-gray-500 shuffling-text mb-2">... ì„ëŠ” ì¤‘ (${i}/${shuffleCount}) ...</span>
                    ${shuffleHtml}
                </div>`;
                progress.textContent = ``; 
                
                let waitTime = totalDelay;
                if (i === shuffleCount) waitTime = 500;
                await delay(waitTime);
            }

            teeOffOrder = playersCopy;

            const finalOrderHtml = teeOffOrder.map((player, index) => 
                `<p class="text-2xl font-extrabold text-gray-900 mb-1">
                    ${index + 1}. <span class="text-green-700">${player}</span>
                </p>`
            ).join('');
            
            display.innerHTML = `<div class="flex flex-col items-center justify-center pt-2 pb-2">${finalOrderHtml}</div>`;
            progress.classList.add('hidden');

            // ì…ë ¥ í•„ë“œ í™œì„±í™” ì²˜ë¦¬
            PLAYER_INPUT_IDS.forEach(id => document.getElementById(id).disabled = false);
            document.getElementById('joker-count-input').disabled = false;
            button.disabled = false;
            shuffleCountInput.disabled = false;
            startButton.disabled = false; // íƒ€ìˆœ ê²°ì • í›„ ê²Œì„ ì‹œì‘ ë²„íŠ¼ í™œì„±í™”
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •
            button.textContent = 'ğŸ² íƒ€ìˆœ ìš´ëª… ì¬ë½‘ê¸°';
            showMessage(`âœ… íƒ€ìˆœì´ ê²°ì •ë˜ì—ˆìŠµë‹ˆë‹¤.`, 'green');
        }


        // --- ëª¨ë‹¬ ë° í™•ì¸ ê´€ë¦¬ í•¨ìˆ˜ (ì¶”ê°€/ìˆ˜ì •ë¨) ---

        // ê²°ê³¼ ëª¨ë‹¬
        function openModal() {
            document.getElementById('results-modal').classList.add('open');
        }

        function closeModal() {
            document.getElementById('results-modal').classList.remove('open');
        }

        // í™•ì¸ ëª¨ë‹¬
        /**
         * ì»¤ìŠ¤í…€ í™•ì¸ ëª¨ë‹¬ì„ ì—´ê³  'í™•ì¸' ë²„íŠ¼ì— ì½œë°± í•¨ìˆ˜ë¥¼ ì—°ê²°í•©ë‹ˆë‹¤.
         */
        function openConfirmModal(title, message, callback) {
            document.getElementById('confirm-title').textContent = title;
            document.getElementById('confirm-message').textContent = message;
            
            const yesButton = document.getElementById('confirm-yes-button');
            
            // ê¸°ì¡´ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë¥¼ ì•ˆì „í•˜ê²Œ ì œê±°í•˜ê³  ìƒˆë¡œ ì¶”ê°€
            yesButton.onclick = null; 
            yesButton.onclick = () => {
                closeConfirmModal();
                callback();
            };

            document.getElementById('confirm-modal').classList.add('open');
        }

        function closeConfirmModal() {
            document.getElementById('confirm-modal').classList.remove('open');
        }
        
        /**
         * ê²Œì„ ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ í™•ì¸ ëª¨ë‹¬ì„ í‘œì‹œí•©ë‹ˆë‹¤.
         * (ì‚¬ìš©ìì˜ ìš”ì²­ì— ë”°ë¼ ì¶”ê°€ëœ í•¨ìˆ˜)
         */
        function handleStartGameConfirmation() {
            if (teeOffOrder.length !== 4) {
                 showMessage("ğŸš¨ ë¨¼ì € 'íƒ€ìˆœ ê²°ì •'ì„ í†µí•´ íƒ€ìˆœì„ ì§€ì •í•´ì£¼ì„¸ìš”.", 'red');
                 return;
            }

            const jokerCount = parseInt(document.getElementById('joker-count-input').value, 10);
            
            openConfirmModal(
                "ê²Œì„ ì‹œì‘ì„ í™•ì¸í•˜ì‹œê² ì–´ìš”?", 
                `4ëª…ì˜ í”„ë¡œì™€ ì¡°ì»¤ ${jokerCount}íšŒë¡œ ê²Œì„ì„ ì‹œì‘í•©ë‹ˆë‹¤.`, 
                confirmGameStart
            );
        }
        
        /**
         * ê²Œì„ ì´ˆê¸°í™” ë²„íŠ¼ í´ë¦­ ì‹œ í™•ì¸ ëª¨ë‹¬ì„ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function handleResetConfirmation() {
             openConfirmModal(
                "ê²Œì„ ì´ˆê¸°í™”ë¥¼ í™•ì¸í•˜ì‹œê² ì–´ìš”?", 
                `ëª¨ë“  ê²Œì„ ê¸°ë¡ê³¼ ì„¤ì •ì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤.`, 
                resetToInitialState
            );
        }


        // --- ê²Œì„ ì´ˆê¸°í™” ë° ìŠ¤ì¼€ì¤„ë§ ---

        /**
         * 1ë²ˆë¶€í„° 18ë²ˆ í™€ ë²„íŠ¼ì„ ìƒì„±í•˜ê³  ì „/í›„ë°˜ìœ¼ë¡œ ë‚˜ëˆ„ì–´ í‘œì‹œí•©ë‹ˆë‹¤.
         */
        function generateHoleButtons() {
            const frontContainer = document.getElementById('hole-buttons-front');
            const backContainer = document.getElementById('hole-buttons-back');
            
            frontContainer.innerHTML = ''; 
            backContainer.innerHTML = '';

            for (let i = 1; i <= MAX_HOLES; i++) {
                const button = document.createElement('button');
                button.id = `hole-btn-${i}`;
                button.className = 'hole-btn bg-gray-300 text-gray-700';
                button.textContent = i;
                button.disabled = false; 
                // í•¨ìˆ˜ëª…ì€ ìœ ì§€í•˜ë˜, ì˜ë¯¸ëŠ” 'í™€ ê²°ê³¼ ë³´ê¸°'ì„
                button.onclick = () => viewHoleResult(i);
                
                if (i <= 9) {
                    frontContainer.appendChild(button);
                } else {
                    backContainer.appendChild(button);
                }
            }
        }

        /**
         * ì¡°ì»¤ ìŠ¤ì¼€ì¤„ì„ ì´ˆê¸°í™”í•©ë‹ˆë‹¤.
         */
        function initializeJokerSchedule(jokerCount) {
            if (jokerCount < 0 || jokerCount > MAX_HOLES) {
                showMessage("ğŸš¨ ì¡°ì»¤ íšŸìˆ˜ëŠ” 0ì—ì„œ 18 ì‚¬ì´ì—¬ì•¼ í•©ë‹ˆë‹¤.", 'red');
                return false;
            }

            jokerSchedule = Array(MAX_HOLES).fill(false);
            const trueIndices = Array.from({ length: MAX_HOLES }, (_, i) => i);
            shuffleArray(trueIndices); 
            
            for (let i = 0; i < jokerCount; i++) {
                if (trueIndices[i] !== undefined) {
                    jokerSchedule[trueIndices[i]] = true;
                }
            }
            
            const remainingDisplay = document.getElementById('joker-remaining');
            const maxJoker = parseInt(document.getElementById('joker-count-input').value, 10);
            remainingDisplay.textContent = `${maxJoker} / ${MAX_HOLES}`;
            return true;
        }

        /**
         * ëª¨ë‹¬ì—ì„œ 'í™•ì¸'ì„ ëˆŒë €ì„ ë•Œ ì‹¤ì œ ê²Œì„ì„ ì‹œì‘í•˜ëŠ” í•¨ìˆ˜ì…ë‹ˆë‹¤.
         * (ê¸°ì¡´ initializeGame()ì˜ í•µì‹¬ ë¡œì§)
         */
        function confirmGameStart() {
            // ì´ í•¨ìˆ˜ëŠ” handleStartGameConfirmation() ëª¨ë‹¬ì˜ ì½œë°±ìœ¼ë¡œë§Œ í˜¸ì¶œë˜ì–´ì•¼ í•¨.
            if (teeOffOrder.length !== 4) {
                 showMessage("ğŸš¨ ë¨¼ì € 'íƒ€ìˆœ ê²°ì •'ì„ í†µí•´ íƒ€ìˆœì„ ì§€ì •í•´ì£¼ì„¸ìš”.", 'red');
                 return;
            }
            
            const jokerCountInput = document.getElementById('joker-count-input').value;
            const jokerCount = parseInt(jokerCountInput, 10);

            if (!initializeJokerSchedule(jokerCount)) return;

            currentHole = 1; 
            holeResults = Array(MAX_HOLES).fill(null); 

            // UI ìƒíƒœ ì „í™˜: ì„¤ì • ì˜ì—­ ìˆ¨ê¸°ê³  ê²Œì„ ì˜ì—­ í‘œì‹œ
            document.getElementById('setup-area').classList.add('hidden');
            document.getElementById('game-area').classList.remove('hidden');

            // N/A í‘œì‹œ ì˜¤ë¥˜ í•´ê²° ë° ì´ˆê¸°í™”
            document.getElementById('current-hole-display').textContent = '1';
            document.getElementById('result-area').classList.add('hidden');
            
            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •
            document.getElementById('start-game-button').textContent = "âœ… ê²Œì„ ì§„í–‰ ì¤‘ (ì„¤ì • ì¬í™•ì¸)";
            document.getElementById('next-draw-button').textContent = `ğŸ¤ 1í™€ íŒ€ ë½‘ê¸°`;
            document.getElementById('next-draw-button').disabled = false;
            
            generateHoleButtons();
            removeHoleActiveClass();
            
            // ì…ë ¥ í•„ë“œ ì ê¸ˆ (ê²Œì„ ì§„í–‰ ì¤‘ ì„¤ì • ë³€ê²½ ë¶ˆê°€)
            PLAYER_INPUT_IDS.forEach(id => document.getElementById(id).disabled = true);
            document.getElementById('shuffle-count-input').disabled = true;
            document.getElementById('tee-off-select-button').disabled = true;
            document.getElementById('joker-count-input').disabled = true;

            // ë©”ì‹œì§€ ìˆ˜ì •
            showMessage("âœ… ë½‘ê¸° ê²Œì„ ì‹œì‘! 1ë²ˆ í™€ íŒ€ì„ ë½‘ì•„ì£¼ì„¸ìš”.", 'indigo');
        }

        /**
         * ê²Œì„ì„ ì´ˆê¸° ìƒíƒœë¡œ ë˜ëŒë¦½ë‹ˆë‹¤. (ìƒˆ ê²Œì„ ì‹œì‘ ì‹œ í˜¸ì¶œ)
         */
        function resetToInitialState() {
            currentHole = 0;
            holeResults = [];
            teeOffOrder = [];
            jokerSchedule = [];

            // UI ìƒíƒœ ì „í™˜: ê²Œì„ ì˜ì—­ ìˆ¨ê¸°ê³  ì„¤ì • ì˜ì—­ í‘œì‹œ
            document.getElementById('game-area').classList.add('hidden');
            document.getElementById('setup-area').classList.remove('hidden');

            // ê¸°íƒ€ UI ì´ˆê¸°í™”
            document.getElementById('result-area').classList.add('hidden');
            document.getElementById('current-hole-display').textContent = 'N/A';
            document.getElementById('joker-remaining').textContent = 'N/A';
            
            // ë²„íŠ¼ ë° ì…ë ¥ í•„ë“œ í™œì„±í™”
            document.getElementById('start-game-button').textContent = "3. ë½‘ê¸° ê²Œì„ ì‹œì‘!";
            document.getElementById('start-game-button').disabled = true; 
            document.getElementById('shuffle-count-input').disabled = false;
            document.getElementById('joker-count-input').disabled = false;
            document.getElementById('tee-off-select-button').disabled = true; // í”„ë¡œ ì…ë ¥ í›„ í™œì„±í™”

            // í”„ë¡œ ì…ë ¥ í•„ë“œ í™œì„±í™”
            PLAYER_INPUT_IDS.forEach(id => document.getElementById(id).disabled = false);

            // ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •
            document.getElementById('tee-off-display').innerHTML = 'íƒ€ìˆœì„ ì •í•´ì£¼ì„¸ìš”!';
            document.getElementById('tee-off-select-button').textContent = 'ğŸ² ë¼ìš´ë“œ íƒ€ìˆœ ìš´ëª… ë½‘ê¸°';
            
            // ì „/í›„ë°˜ ë²„íŠ¼ ì˜ì—­ ì´ˆê¸°í™”
            document.getElementById('hole-buttons-front').innerHTML = '';
            document.getElementById('hole-buttons-back').innerHTML = '';

            // í”„ë¡œ ì…ë ¥ì°½/ë¦¬ìŠ¤íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸ (ìœ íš¨ì„± ê²€ì‚¬ íŠ¸ë¦¬ê±°)
            updatePlayerList(); 
            
            showMessage("ğŸ”„ ê²Œì„ì´ ì´ˆê¸°í™”ë˜ì—ˆìŠµë‹ˆë‹¤. ì„¤ì •ì„ ë‹¤ì‹œ í•´ì£¼ì„¸ìš”.", 'yellow');
        }


        /**
         * ê²Œì„ ì¢…ë£Œ ì‹œ, ê²°ê³¼ë¥¼ ìš”ì•½í•˜ì—¬ ëª¨ë‹¬ì— í‘œì‹œí•©ë‹ˆë‹¤.
         * (ìˆ˜ì •) ì´ì œ ê²Œì„ ìƒíƒœë¥¼ ìœ ì§€í•˜ê³  ëª¨ë‹¬ë§Œ ì—½ë‹ˆë‹¤. ì´ˆê¸°í™”ëŠ” ëª¨ë‹¬ ì•ˆì—ì„œ ìˆ˜í–‰ë©ë‹ˆë‹¤.
         */
        function showFinalSummary() {
            const summaryContainer = document.getElementById('final-results-summary');
            const summaryMessage = document.getElementById('game-summary-message');
            summaryContainer.innerHTML = '';
            
            let winCount = 0;
            let lossCount = 0;
            let tieCount = 0; 

            const playedHoles = holeResults.filter(r => r !== null);
            if (playedHoles.length === 0) {
                 summaryMessage.textContent = "âš ï¸ ë½‘ê¸°ëœ í™€ì´ ì—†ì–´ í‘œì‹œí•  ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤. 'ìƒˆ ê²Œì„ ì‹œì‘' ë²„íŠ¼ì„ ëˆŒëŸ¬ ê²Œì„ì„ ì‹œì‘í•˜ì„¸ìš”.";
                 summaryContainer.innerHTML = '';
                 openModal();
                 return;
            }

            holeResults.forEach((result, index) => {
                const holeNumber = index + 1;
                
                if (result) {
                    let scoreText = 'ë™ì '; 
                    let bgColor = 'score-tie'; 
                    
                    if (result.score === TEAM_SCORE.RED_WIN) {
                        scoreText = `${TEAM_COLORS[1]} ìŠ¹`; 
                        winCount++;
                        bgColor = 'score-win';
                    } else if (result.score === TEAM_SCORE.BLUE_WIN) {
                        scoreText = `${TEAM_COLORS[2]} ìŠ¹`;
                        lossCount++;
                        bgColor = 'score-loss';
                    } else { // TEAM_SCORE.TIE
                        scoreText = 'ë™ì  (íƒ€ì´)'; 
                        tieCount++;
                        bgColor = 'score-tie';
                    }
                    
                    const item = document.createElement('div');
                    // íŒ€ ë§¤ì¹­ í”„ë¡œ ì´ë¦„ì„ í‘œì‹œí•˜ê¸° ìœ„í•´ flex-colë¡œ ë³€ê²½
                    item.className = `result-grid-item flex-col items-start ${bgColor} p-3`; 
                    
                    // ì¡°ì»¤ í™€ í‘œì‹œ
                    const jokerIcon = result.isJoker ? '<span class="text-yellow-700 font-extrabold ml-1">ğŸ‘‘</span>' : '';
                    
                    // 2. íŒ€ ë§¤ì¹­ í”„ë¡œ ì´ë¦„ í‘œì‹œ ì¶”ê°€
                    item.innerHTML = `
                        <div class="w-full flex justify-between items-center mb-1 pb-1 border-b border-opacity-30">
                            <span class="font-extrabold text-lg">${holeNumber}H ${jokerIcon}</span>
                            <span class="text-sm font-extrabold">${scoreText}</span>
                        </div>
                        <div class="text-xs w-full text-left leading-tight mt-1">
                            <p class="font-semibold text-red-700">${TEAM_COLORS[1]}: ${result.team1.join(' & ')}</p>
                            <p class="font-semibold text-blue-700">${TEAM_COLORS[2]}: ${result.team2.join(' & ')}</p>
                        </div>
                    `;
                    summaryContainer.appendChild(item);
                }
            });

            // ìµœì¢… ë©”ì‹œì§€ (ìˆ˜ì •) T1/T2 -> RED/BLUE
            summaryMessage.innerHTML = `
                ì´ ${playedHoles.length} í™€ ì™„ë£Œ | 
                ${TEAM_COLORS[1]} ìŠ¹: <span class="text-red-700 font-extrabold">${winCount}</span> | 
                ${TEAM_COLORS[2]} ìŠ¹: <span class="text-blue-700 font-extrabold">${lossCount}</span> | 
                ë™ì : <span class="text-teal-700 font-extrabold">${tieCount}</span>
            `;

            // ê²Œì„ ìƒíƒœë¥¼ ì´ˆê¸°í™”í•˜ì§€ ì•Šê³  ëª¨ë‹¬ í‘œì‹œ
            openModal();
        }

        // --- ê²Œì„ ì§„í–‰ ë° ê²°ê³¼ ë Œë”ë§ ë¡œì§ ---

        /**
         * í˜„ì¬ í™€ì˜ íŒ€ì„ ê²°ì •í•©ë‹ˆë‹¤.
         */
        function determineTeams(players, isJokerHole) {
            const teamResult = { 
                hole: currentHole,
                team1: [], 
                team2: [], 
                drawnPlayers: [], 
                joker: null,
                isJoker: isJokerHole,
                score: null, 
                teeOffOrder: [...teeOffOrder] 
            };

            if (isJokerHole) {
                const shuffledPlayers = shuffleArray([...players]);
                const jokerPlayer = shuffledPlayers.pop();
                teamResult.joker = jokerPlayer;

                let remainingSticks = [DRAW_STICKS.RED, DRAW_STICKS.RED, DRAW_STICKS.BLUE];
                shuffleArray(remainingSticks);
                
                let assignment = {};
                assignment[jokerPlayer] = DRAW_STICKS.JOKER;
                shuffledPlayers.forEach((p, i) => assignment[p] = remainingSticks[i]);

                const blueStickPlayer = shuffledPlayers.find((p) => assignment[p] === DRAW_STICKS.BLUE);
                const redStickPlayers = shuffledPlayers.filter((p) => assignment[p] === DRAW_STICKS.RED);

                // íŒ€ 1: ì¡°ì»¤ + ë¸”ë£¨ (2ëª…) - ì¡°ì»¤ê°€ BLUE ìŠ¤í‹±ì„ ë½‘ì€ í”Œë ˆì´ì–´ì™€ í•œ íŒ€
                teamResult.team1 = [jokerPlayer, blueStickPlayer]; 
                
                // íŒ€ 2: ë ˆë“œ 2ëª… (2ëª…)
                teamResult.team2 = redStickPlayers; 
                
                // ë½‘ê¸° ìƒì„¸ ë‚´ì—­ì„ ìœ„í•´ ëª¨ë“  í”„ë¡œ í• ë‹¹ ì €ì¥
                players.forEach(p => {
                    const draw = teamResult.drawnPlayers.find(dp => dp.name === p);
                    if(!draw) {
                        teamResult.drawnPlayers.push({ name: p, stick: assignment[p] || DRAW_STICKS.JOKER });
                    }
                });

            } else {
                let sticksToAssign = [DRAW_STICKS.RED, DRAW_STICKS.RED, DRAW_STICKS.BLUE, DRAW_STICKS.BLUE];
                shuffleArray(sticksToAssign);
                
                let assignment = {};
                players.forEach((p, i) => {
                    assignment[p] = sticksToAssign[i];
                    teamResult.drawnPlayers.push({ name: p, stick: sticksToAssign[i] });
                });
                
                teamResult.team1 = players.filter(p => assignment[p] === DRAW_STICKS.RED);
                teamResult.team2 = players.filter(p => assignment[p] === DRAW_STICKS.BLUE);
            }

            return teamResult;
        }

        /**
         * ìŠ¹ë¦¬ íŒ€ ì„ íƒ ì‹œ ì‹œê°ì  ìš”ì†Œë¥¼ ì—…ë°ì´íŠ¸í•˜ê³  ì ìˆ˜ë¥¼ ê¸°ë¡í•©ë‹ˆë‹¤.
         * @param {number} holeNumber - í˜„ì¬ í‘œì‹œ ì¤‘ì¸ í™€ ë²ˆí˜¸
         * @param {boolean} initialize - ì´ˆê¸°í™” ëª¨ë“œ (ìŠ¤ì½”ì–´ ì»¤ë°‹ ì—†ì´ ì‹œê°ì  ìƒíƒœë§Œ ì—…ë°ì´íŠ¸)
         */
        function updateTeamSelectionVisuals(holeNumber, initialize = false) {
            const holeIndex = holeNumber - 1;
            const result = holeResults[holeIndex];

            if (!result) return;
            
            const team1Box = document.getElementById('team1-players');
            const team2Box = document.getElementById('team2-players');
            const scoreStatus = document.getElementById('score-status');

            team1Box.classList.remove('team-selected-win');
            team2Box.classList.remove('team-selected-loss');
            
            team1Box.classList.add('border-red-400', 'text-red-700');
            team2Box.classList.add('border-blue-400', 'text-blue-700');
            
            let scoreText = 'ë™ì '; 

            if (result.score === TEAM_SCORE.RED_WIN) {
                team1Box.classList.add('team-selected-win');
                scoreText = `${TEAM_COLORS[1]} ìŠ¹ë¦¬`; 
            } else if (result.score === TEAM_SCORE.BLUE_WIN) {
                team2Box.classList.add('team-selected-loss');
                scoreText = `${TEAM_COLORS[2]} ìŠ¹ë¦¬`;
            } 
            
            // ë¬¸êµ¬ ê°„ì†Œí™”
            scoreStatus.textContent = `â­ í˜„ì¬ ê¸°ë¡: ${scoreText} (í´ë¦­í•˜ì—¬ ìˆ˜ì • ê°€ëŠ¥)`;
        }

        /**
         * íŒ€ ë°•ìŠ¤ í´ë¦­ ì‹œ ìŠ¹ë¦¬ íŒ€ì„ í† ê¸€í•©ë‹ˆë‹¤.
         * @param {number} clickedTeam - í´ë¦­ëœ íŒ€ ë²ˆí˜¸ (1: RED, 2: BLUE)
         */
        function toggleWinningTeam(clickedTeam) {
            // í˜„ì¬ í‘œì‹œ ì¤‘ì¸ í™€ ë²ˆí˜¸ë¥¼ DOMì—ì„œ ê°€ì ¸ì˜µë‹ˆë‹¤.
            const holeNumberElement = document.getElementById('result-hole-number');
            const holeNumber = parseInt(holeNumberElement.textContent, 10);
            const holeIndex = holeNumber - 1;

            if (isNaN(holeNumber) || holeIndex < 0 || holeIndex >= MAX_HOLES || !holeResults[holeIndex]) {
                 showMessage("ğŸš¨ í˜„ì¬ í‘œì‹œëœ í™€ì´ ì—†ê±°ë‚˜ ìœ íš¨í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤. ë¨¼ì € íŒ€ì„ ë½‘ì•„ì£¼ì„¸ìš”.", 'red');
                 return;
            }
            
            const currentResult = holeResults[holeIndex];
            let nextScoreValue = TEAM_SCORE.TIE; // Default to TIE

            if (clickedTeam === 1) {
                // RED íŒ€ í´ë¦­: í˜„ì¬ RED ìŠ¹ë¦¬ë©´ TIEë¡œ, ì•„ë‹ˆë©´ RED ìŠ¹ë¦¬(WIN)ë¡œ í† ê¸€
                nextScoreValue = (currentResult.score === TEAM_SCORE.RED_WIN) ? TEAM_SCORE.TIE : TEAM_SCORE.RED_WIN;
            } else if (clickedTeam === 2) {
                // BLUE íŒ€ í´ë¦­: í˜„ì¬ BLUE ìŠ¹ë¦¬ë©´ TIEë¡œ, ì•„ë‹ˆë©´ BLUE ìŠ¹ë¦¬(LOSS)ë¡œ í† ê¸€
                nextScoreValue = (currentResult.score === TEAM_SCORE.BLUE_WIN) ? TEAM_SCORE.TIE : TEAM_SCORE.BLUE_WIN;
            }
            
            // 1. ì ìˆ˜ ì—…ë°ì´íŠ¸ ë° UI ë°˜ì˜
            _commitScore(nextScoreValue, holeNumber);

            // 2. ì‹œê°ì  ì—…ë°ì´íŠ¸ (ì ìˆ˜ ì—…ë°ì´íŠ¸ í›„ ê²°ê³¼ ê°ì²´ë¥¼ ìƒˆë¡œ ì½ì–´ì„œ ë°˜ì˜)
            updateTeamSelectionVisuals(holeNumber, true);
        }

        /**
         * íŒ€ ê²°ì • ê²°ê³¼ (Team Draw Result)ë¥¼ UIì— ë Œë”ë§í•©ë‹ˆë‹¤.
         */
        function renderResult(result, holeNumber) {
            const resultArea = document.getElementById('result-area');
            
            // íŒ€ ë°•ìŠ¤ì—ì„œ ì• ë‹ˆë©”ì´ì…˜ í´ë˜ìŠ¤ ì œê±°
            document.getElementById('team1-players').classList.remove('shuffling-name');
            document.getElementById('team2-players').classList.remove('shuffling-name');

            resultArea.classList.remove('hidden');
            document.getElementById('result-hole-number').textContent = holeNumber;

            const jokerStatusElement = document.getElementById('joker-status');
            if (result.isJoker) {
                jokerStatusElement.innerHTML = `ğŸ‘‘ ì¡°ì»¤ í™€: <span class="text-2xl font-extrabold text-yellow-800">${result.joker}</span> í”„ë¡œ`;
                jokerStatusElement.className = 'text-center font-bold text-xl mb-4 p-2 rounded-lg bg-yellow-100 text-yellow-800';
            } else {
                jokerStatusElement.textContent = `âšª ì¼ë°˜ í™€ (2 vs 2)`;
                jokerStatusElement.className = 'text-center font-bold text-lg mb-4 p-2 rounded-lg bg-gray-100 text-gray-700';
            }

            // ìµœì¢… ê²°ì •ëœ íŒ€ ì´ë¦„ í‘œì‹œ: ì œëª©ê³¼ í”„ë¡œ ëª©ë¡ ë¶„ë¦¬
            document.getElementById('team1-players').innerHTML = 
                `<span class="text-xl font-extrabold text-red-700 mb-1">${TEAM_COLORS[1]}</span>
                 <span class="text-lg font-bold">${result.team1.join(' & ')}</span>`;
            document.getElementById('team2-players').innerHTML = 
                `<span class="text-xl font-extrabold text-blue-700 mb-1">${TEAM_COLORS[2]}</span>
                 <span class="text-lg font-bold">${result.team2.join(' & ')}</span>`;

            // ë½‘ê¸° ìƒì„¸ í…ìŠ¤íŠ¸ ìˆ˜ì •
            let drawDetails = 'ë½‘ê¸° ìš´ëª… ìŠ¤í‹± ê²°ê³¼ (íƒ€ìˆœ ìˆœ): ';
            result.teeOffOrder.forEach((player, index) => {
                const draw = result.drawnPlayers.find(p => p.name === player);
                if (draw) {
                    let stickDisplay = draw.stick;
                    let colorClass = 'text-gray-600';
                    
                    if (draw.stick === DRAW_STICKS.RED) { colorClass = 'text-red-600'; stickDisplay = 'ë ˆë“œ'; } 
                    else if (draw.stick === DRAW_STICKS.BLUE) { colorClass = 'text-blue-600'; stickDisplay = 'ë¸”ë£¨'; } 
                    else if (draw.stick === DRAW_STICKS.JOKER) { colorClass = 'text-yellow-700 font-extrabold'; stickDisplay = 'ì¡°ì»¤'; }
                    
                    drawDetails += `<span class="${colorClass}">${player}(${stickDisplay})</span>`;
                    if (index < result.teeOffOrder.length - 1) { drawDetails += ' / '; }
                }
            });
            document.getElementById('draw-details').innerHTML = drawDetails;

            // ì‹œê°ì  ìƒíƒœ ì—…ë°ì´íŠ¸ (ì ìˆ˜ ìƒíƒœ ë°˜ì˜)
            updateTeamSelectionVisuals(holeNumber, true); 

            removeHoleActiveClass();
            document.getElementById(`hole-btn-${holeNumber}`).classList.add('hole-active');
            
            updateNextDrawButtonState();

            // ì‹œê°ì  ìš”ì†Œ ì¶”ê°€: ê²°ê³¼ ì˜ì—­ì— ì• ë‹ˆë©”ì´ì…˜ ì ìš©
            resultArea.classList.remove('result-pulse');
            // DOM reflowë¥¼ ìœ„í•œ íŠ¸ë¦­
            void resultArea.offsetWidth; 
            resultArea.classList.add('result-pulse');
            
            // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ë°”ë¡œ ë³¼ ìˆ˜ ìˆê²Œ ì²˜ë¦¬
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function removeHoleActiveClass() {
            for (let i = 1; i <= MAX_HOLES; i++) {
                const btn = document.getElementById(`hole-btn-${i}`);
                if (btn) {
                    btn.classList.remove('hole-active');
                }
            }
        }

        function viewHoleResult(holeNumber) {
            const result = holeResults[holeNumber - 1];
            
            if (!result) {
                 showMessage(`âš ï¸ ${holeNumber}í™€ì€ ì•„ì§ íŒ€ì„ ë½‘ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.`, 'red');
                 return;
            }

            renderResult(result, holeNumber);
        }

        function updateHoleButtonVisuals(holeNumber) {
            const result = holeResults[holeNumber - 1];
            const button = document.getElementById(`hole-btn-${holeNumber}`);
            
            if (!button || !result) return;
            
            button.className = 'hole-btn'; 

            if (result.score === TEAM_SCORE.RED_WIN) {
                button.classList.add('score-win');
            } else if (result.score === TEAM_SCORE.BLUE_WIN) {
                button.classList.add('score-loss');
            } else { // TEAM_SCORE.TIE (ë™ì )
                button.classList.add('score-tie'); 
            }
            
            button.disabled = false;
        }

        function updateNextDrawButtonState() {
            const nextDrawButton = document.getElementById('next-draw-button');

            if (currentHole > MAX_HOLES) {
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •
                nextDrawButton.textContent = "18í™€ íŒ€ ë½‘ê¸° ì™„ë£Œ!";
                nextDrawButton.disabled = true;
            } else {
                nextDrawButton.disabled = false;
                // ë²„íŠ¼ í…ìŠ¤íŠ¸ ìˆ˜ì •
                nextDrawButton.textContent = `ğŸ¤ ${currentHole}í™€ íŒ€ ë½‘ê¸°`;
            }
        }

        /**
         * ì‹¤ì œ ìŠ¤ì½”ì–´ ê°’ì„ ì €ì¥í•˜ê±°ë‚˜ ìˆ˜ì •í•©ë‹ˆë‹¤.
         * @param {string} scoreValue - 'WIN', 'LOSS', 'TIE'
         * @param {number} holeNumber - í˜„ì¬ ìˆ˜ì •í•˜ëŠ” í™€ ë²ˆí˜¸
         */
        function _commitScore(scoreValue, holeNumber) {
            const holeIndex = holeNumber - 1;

            if (holeIndex < 0 || holeIndex >= MAX_HOLES || !holeResults[holeIndex]) {
                showMessage("ğŸš¨ ì €ì¥í•  ìœ íš¨í•œ í™€ ê²°ê³¼ê°€ ì—†ìŠµë‹ˆë‹¤.", 'red');
                return;
            }
            
            const oldScore = holeResults[holeIndex].score;
            
            holeResults[holeIndex].score = scoreValue;
            updateHoleButtonVisuals(holeNumber);
            
            let scoreText;
            if (scoreValue === TEAM_SCORE.RED_WIN) scoreText = `${TEAM_COLORS[1]} ìŠ¹ë¦¬`; 
            else if (scoreValue === TEAM_SCORE.BLUE_WIN) scoreText = `${TEAM_COLORS[2]} ìŠ¹ë¦¬`; 
            else scoreText = 'ë™ì '; 
            
            
            if (oldScore === null || oldScore === TEAM_SCORE.TIE) { 
                 showMessage(`âœ… ${holeNumber}í™€ ê²°ê³¼ê°€ [${scoreText}]ë¡œ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'green');
            } else if (oldScore !== scoreValue) {
                 showMessage(`âœï¸ ${holeNumber}í™€ ê²°ê³¼ê°€ [${scoreText}]ë¡œ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!`, 'indigo');
            }
            
            updateNextDrawButtonState();
        }

        /**
         * ë½‘ê¸°(íŒ€ ë½‘ê¸°)ë¥¼ ì²˜ë¦¬í•˜ê³  ê²°ê³¼ë¥¼ ì €ì¥í•©ë‹ˆë‹¤. (ì• ë‹ˆë©”ì´ì…˜ ì¶”ê°€)
         */
        async function handleDraw() {
            
            if (currentHole > MAX_HOLES) {
                showMessage("ğŸ‰ 18í™€ íŒ€ ë½‘ê¸° ì™„ë£Œ! ìµœì¢… ì ìˆ˜ë¥¼ í™•ì¸í•˜ê³  ê²°ê³¼ ìš”ì•½ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.", 'yellow');
                return;
            }

            const nextDrawButton = document.getElementById('next-draw-button');
            nextDrawButton.disabled = true; // ë½‘ê¸° ì§„í–‰ ì¤‘ ë²„íŠ¼ ë¹„í™œì„±í™”

            const team1Box = document.getElementById('team1-players');
            const team2Box = document.getElementById('team2-players');
            const resultArea = document.getElementById('result-area');
            
            resultArea.classList.remove('hidden'); // ì• ë‹ˆë©”ì´ì…˜ì„ ìœ„í•´ ê²°ê³¼ ì˜ì—­ì„ ë¨¼ì € í‘œì‹œ
            
            // ê²°ê³¼ ì˜ì—­ìœ¼ë¡œ ìŠ¤í¬ë¡¤í•˜ì—¬ ì• ë‹ˆë©”ì´ì…˜ì´ ë³´ì´ë„ë¡ ì²˜ë¦¬
            resultArea.scrollIntoView({ behavior: 'smooth', block: 'start' });

            // --- 1. Animation Setup ---
            const drawHoleNumber = currentHole;
            const isJokerHole = jokerSchedule[drawHoleNumber - 1];

            // ì„ì‹œ ì• ë‹ˆë©”ì´ì…˜ ë¬¸êµ¬ ì„¤ì •
            team1Box.innerHTML = `<span class="text-3xl font-extrabold text-red-700">${TEAM_COLORS[1]}</span>`;
            team2Box.innerHTML = `<span class="text-3xl font-extrabold text-blue-700">${TEAM_COLORS[2]}</span>`;
            document.getElementById('score-status').textContent = '... ìš´ëª…ì˜ íŒ€ì„ ë½‘ëŠ” ì¤‘ ...';
            
            const animationDuration = 2500; // 2.5ì´ˆ (ë³´í†µ ì†ë„ë¡œ ì¡°ì •ë¨)
            let animationStartTime = performance.now();
            let animationFrameId;

            // --- 2. Animation Loop ---
            const animateDraw = (timestamp) => {
                if (timestamp - animationStartTime < animationDuration) {
                    // í”„ë¡œ ëª©ë¡ì„ ë¬´ì‘ìœ„ë¡œ ì„ì–´ í‘œì‹œ
                    const playersCopy = shuffleArray([...currentPlayers]);
                    
                    const t1_shuffled = playersCopy.slice(0, 2).map(p => `<span class="shuffling-name text-red-600">${p}</span>`).join(' & ');
                    const t2_shuffled = playersCopy.slice(2, 4).map(p => `<span class="shuffling-name text-blue-600">${p}</span>`).join(' & ');

                    // ì»¨í…ì¸  ì—…ë°ì´íŠ¸
                    team1Box.innerHTML = `<span class="text-xl font-extrabold text-red-700 mb-1">${TEAM_COLORS[1]}</span><div class="p-1">${t1_shuffled}</div>`;
                    team2Box.innerHTML = `<span class="text-xl font-extrabold text-blue-700 mb-1">${TEAM_COLORS[2]}</span><div class="p-1">${t2_shuffled}</div>`;
                    
                    animationFrameId = requestAnimationFrame(animateDraw);
                } else {
                    // Animation finished
                    cancelAnimationFrame(animationFrameId);
                    
                    // --- 3. Determination and Rendering ---
                    const result = determineTeams(currentPlayers, isJokerHole); 
                    result.score = TEAM_SCORE.TIE;
                    holeResults[drawHoleNumber - 1] = result;
                    
                    // ìµœì¢… ê²°ê³¼ ë Œë”ë§ (ì´ ì•ˆì—ì„œ Pulse ì• ë‹ˆë©”ì´ì…˜ ì ìš©)
                    renderResult(result, drawHoleNumber);
                    
                    // 4. ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ 
                    updateHoleButtonVisuals(drawHoleNumber);
        
                    // 5. ë‚¨ì€ ì¡°ì»¤ íšŸìˆ˜ ì—…ë°ì´íŠ¸
                    const remaining = jokerSchedule.slice(drawHoleNumber).filter(j => j).length;
                    const maxJoker = parseInt(document.getElementById('joker-count-input').value, 10);
                    document.getElementById('joker-remaining').textContent = `${remaining} / ${maxJoker}`;
                    
                    // 6. ë‹¤ìŒ í™€ ìƒíƒœë¡œ ì „í™˜
                    currentHole++;
                    
                    // 7. ë‹¤ìŒ ë½‘ê¸° ë²„íŠ¼ ìƒíƒœ ì—…ë°ì´íŠ¸ (ì¬í™œì„±í™”)
                    updateNextDrawButtonState();
        
                    if (drawHoleNumber === MAX_HOLES) {
                         showMessage("ğŸ‰ 18í™€ íŒ€ ë½‘ê¸° ì™„ë£Œ! ìŠ¹íŒ¨ë¥¼ ê¸°ë¡í•˜ê³  ê²°ê³¼ ìš”ì•½ ë²„íŠ¼ì„ ëˆ„ë¥´ì„¸ìš”.", 'yellow');
                    } else {
                         showMessage(`âœ¨ ${drawHoleNumber}í™€ íŒ€ ë½‘ê¸° ì™„ë£Œ. ìŠ¹íŒ¨ë¥¼ ê¸°ë¡í•˜ê±°ë‚˜ ë‹¤ìŒ í™€ë¡œ ì§„í–‰í•˜ì„¸ìš”.`, 'indigo');
                    }
                }
            };

            // Start animation
            animateDraw(animationStartTime);
        }

        // --- ì´ˆê¸°í™” ---
        window.onload = () => {
             // í˜ì´ì§€ ë¡œë“œ ì‹œ í”„ë¡œ ëª©ë¡ ìœ íš¨ì„±ì„ ì²´í¬í•˜ì—¬ ë²„íŠ¼ í™œì„±í™” ìƒíƒœë¥¼ ê²°ì •
             updatePlayerList(); 
             // ì´ˆê¸° ìƒíƒœë¡œ ì™„ì „íˆ ì´ˆê¸°í™”í•˜ì—¬ ì‹œì‘ (ì¬ì‹œì‘ í¬í•¨)
             resetToInitialState();
             closeModal();
             closeConfirmModal(); // ìƒˆ ëª¨ë‹¬ë„ ë‹«ì•„ì¤ë‹ˆë‹¤.
        };

    </script>
</body>
</html>

